<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="/assets/images/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png" />
    <link rel="manifest" href="/assets/images/site.webmanifest" />
    <link rel="mask-icon" href="/assets/images/safari-pinned-tab.svg" color="DarkGreen" />

    <link href="/compiled.css?v=[SHORT-COMMIT-HASH]" rel="stylesheet" />

    <!-- Begin Kaylumah SEO tag v[SHORT-COMMIT-HASH] -->
    
    <!-- Common Meta Tags -->
    <title>Generate C# client for OpenAPI - Revisited</title>
    <link rel="canonical" href="https://BaseUrl_1/2023/04/14/csharp-client-for-openapi-revistted.html" />
    <meta name="generator" content="Kaylumah v[SHORT-COMMIT-HASH]" />
    <meta name="description" content="A comparison of NSwag.MSBuild and OpenApiReference" />
    <meta name="copyright" content="© Kaylumah. All rights reserved." />
    <meta name="keywords" content="csharp, nswag, openapi, swashbuckle" />
    
    <!-- OpenGraph Meta Tags -->
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en" />
    <meta property="og:site_name" content="Max Hamulyák · Kaylumah" />
    <meta property="og:title" content="Generate C# client for OpenAPI - Revisited" />
    <meta property="og:url" content="https://BaseUrl_1/2023/04/14/csharp-client-for-openapi-revistted.html" />
    <meta property="og:description" content="A comparison of NSwag.MSBuild and OpenApiReference" />
    <meta property="og:image" content="https://BaseUrl_1/assets/images/posts/20230414/openapi/cover_image.png" />
    <meta property="article:author" content="Max Hamulyák" />
    <meta property="article:published_time" content="2023-04-14T00:00:00.0000000+02:00" />
    <meta property="article:modified_time" content="2023-04-14T00:00:00.0000000+02:00" />
    <meta property="article:tag" content="csharp" />
    <meta property="article:tag" content="nswag" />
    <meta property="article:tag" content="openapi" />
    <meta property="article:tag" content="swashbuckle" />
    
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Generate C# client for OpenAPI - Revisited" />
    <meta name="twitter:description" content="A comparison of NSwag.MSBuild and OpenApiReference" />
    <meta name="twitter:image" content="https://BaseUrl_1/assets/images/posts/20230414/openapi/cover_image.png" />
    <meta name="twitter:site" content="@kaylumah" />
    <meta name="twitter:creator" content="@kaylumah" />
    
    <!-- Kaylumah BuildInfo Meta Tags -->
    <meta property="kaylumah:copyright" content="© Kaylumah. All rights reserved." />
    <meta property="kaylumah:commit" content="[COMMIT-HASH]" />
    <meta property="kaylumah:version" content="1.0.0.BuildNumber_1" />
    <meta property="kaylumah:buildId" content="[BUILD-ID]" />
    <meta property="kaylumah:buildNumber" content="BuildNumber_1" />
    <meta property="kaylumah:time" content="DateTimeOffset_1" />
    <meta property="kaylumah:site" content="Guid_1" />
    <meta property="kaylumah:page" content="Guid_2" />
    
    <!-- LdJson Meta Tags -->
    <script type="application/ld+json">{
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "description": "A comparison of NSwag.MSBuild and OpenApiReference",
      "image": "https://BaseUrl_1/assets/images/posts/20230414/openapi/cover_image.png",
      "mainEntityOfPage": "https://BaseUrl_1/2023/04/14/csharp-client-for-openapi-revistted.html",
      "url": "https://BaseUrl_1/2023/04/14/csharp-client-for-openapi-revistted.html",
      "author": {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Max Hamulyák",
        "image": "https://BaseUrl_1/assets/avatar_background.svg",
        "sameAs": [
          "https://www.linkedin.com/in/maxhamulyak",
          "https://twitter.com/kaylumah"
        ],
        "email": "max@kaylumah.nl"
      },
      "dateModified": "2023-04-14T00:00:00+02:00",
      "datePublished": "2023-04-14T00:00:00+02:00",
      "headline": "Generate C# client for OpenAPI - Revisited",
      "keywords": "csharp,nswag,openapi,swashbuckle",
      "publisher": {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "kaylumah",
        "sameAs": "https://www.linkedin.com/company/kaylumah",
        "foundingDate": "2020-01-01",
        "logo": "https://BaseUrl_1/assets/logo.svg"
      }
    }</script>
    
    <!-- End Kaylumah SEO tag -->
    <!-- BEGIN Feed MetaData-->
    <link
      type="application/atom+xml"
      rel="alternate"
      href="https://BaseUrl_1/feed.xml"
      title="Max Hamulyák · Kaylumah RSS Feed"
    />
    <!-- END Feed MetaData -->
    <!--
                                                        
       _  __           _                       _        
      | |/ /__ _ _   _| |_   _ _ __ ___   __ _| |__     
      | ' // _` | | | | | | | | '_ ` _ \ / _` | '_ \    
      | . \ (_| | |_| | | |_| | | | | | | (_| | | | |   
      |_|\_\__,_|\__, |_|\__,_|_| |_| |_|\__,_|_| |_|   
                 |___/                                  
                                                        
     You found 🧸                                      
                                                       
    -->
    
    <script>
    
      const consoleSignatureText = '%c👨‍💻 Thank you for your visit to my little spot on the internet, be welcome! 🧸';
      const consoleSignatureStyle = `
      font-size: 16px;
      background: #4cae50;
      color: white;
      text-align: center;
      padding: 10px 15px;
      width: 100%;
      border-radius: 20px;
    `;
      console.log(consoleSignatureText, consoleSignatureStyle);
    </script>
    <script>
      window.getCookieConsent = function() {
          try {
              const consent = document.cookie.match(/cookie-consent=([^;]+)/)[1];
              return consent;
          } catch (error) {
              console.log("failed to retrieve consent", error);
              return "unknown";
          }
      };
    
      window.setCookieConsent = function(status) {
    
        if (status != "denied" && status != "granted") {
          throw new Error(`Status ${status} is not supported!`);
        }
    
        let today = new Date();
        let expiryDate = new Date(today.getFullYear() + 1, today.getMonth(), today.getDate());
        document.cookie = `cookie-consent=${status}; expires=${expiryDate}; path=/`;
      }
    
    </script>
    <script>
      // Define dataLayer and the gtag function.
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
    
      window.setGtagConsentStatus = function(mode, status) {
    
        if (mode != "update" && mode != "default") {
          throw new Error(`Mode ${mode} is not supported!`);
        }
    
        if (status != "denied" && status != "granted") {
          throw new Error(`Status ${status} is not supported!`);
        }
    
        gtag('consent', mode, {
          'ad_storage': status,
          'ad_user_data': status,
          'ad_personalization': status,
          'analytics_storage': status
        });
      }
    
      let currentStatus = window.getCookieConsent();
      let cookiesAllowed = currentStatus == "granted";
    
      if (cookiesAllowed) {
        console.log("cookies already approved");
        window.setGtagConsentStatus("default", "granted");
      } else {
        console.log("assume cookies are denied");
        window.setGtagConsentStatus("default", "denied");
      }
    </script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-168549883-1">
    </script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
    
      gtag('js', new Date());
      gtag('config', 'UA-168549883-1');
    </script>
    <link href="https://mastodon.nl/@kaylumah" rel="me">
</head>

<body class="bg-gray-100 antialiased">
    <div class="flex flex-col h-screen">
        <header class="bg-gray-900">
            <nav class="flex flex-wrap items-center justify-between p-4">
                <a data-testid="NavLink-Home" href="/" rel="home">
                    <img data-testid="NavLogo" class="h-12 w-20" height="48" width="80"
                        src="/assets/logo.svg" alt="Kaylumah" />
                </a>
                <button id="hamburger"
                    class="tablet:hidden p-2 rounded-md text-gray-100 hover:text-gray-400 hover:bg-gray-500">
                    <span class="sr-only">Open main menu</span>
                    <svg class="toggle block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                    <svg class="toggle hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <ul
                    class="toggle hidden tablet:flex w-full tablet:w-auto text-right text-bold mt-5 tablet:mt-0 border-t-2 border-gray-600 tablet:border-none">
                    
                                        <li>
                                            <a data-testid="NavLink-Blog" href="/blog.html"
                                                class="block tablet:inline-block text-gray-100 hover:text-gray-400 px-3 py-3 border-b-2 border-gray-600 tablet:border-none">
                                                Blog
                                            </a>
                                        </li>
                                        
                </ul>
            </nav>
            <script>
                document.getElementById('hamburger').onclick = function toggleMenu() {
                    const navToggle = document.getElementsByClassName('toggle');
                    for (let i = 0; i < navToggle.length; i++) {
                        navToggle.item(i).classList.toggle('hidden');
                    }
                };
            </script>
        </header>
        <main class="flex-1 p-4 text-gray-900">
            <div class="flex flex-col gap-8 laptop:flex-row">
    <article id="blogContents" class="flex-1 bg-slate-50 border-2 p-6 flex flex-col gap-8">
        <header class="prose laptop:mx-auto">
            <picture class="hidden">
                <source type="image/webp" srcset="/assets/images/posts/20230414/openapi/cover_image.webp">
                <img src="/assets/images/posts/20230414/openapi/cover_image.png" alt="cover for Generate C# client for OpenAPI - Revisited" height="640" width="1280" />
            </picture>
            <h1>Generate C# client for OpenAPI - Revisited</h1>
            <div class="flex flex-row gap-4">
                <time datetime="2023-04-14">2023/04/14</time>
                <span>Max Hamulyák</span>
                <span>7 minute</span>
            </div>
            <span class="flex flex-row gap-4">
                
                                <a href="/blog.html?tag=csharp" title="for the C# programming language">C#</a>
                                
                                <a href="/blog.html?tag=nswag" title="for the NSwag swagger tooling in .NET">NSwag</a>
                                
                                <a href="/blog.html?tag=openapi" title="for the OpenAPI Specification (formerly Swagger Specification)">OpenAPI</a>
                                
                                <a href="/blog.html?tag=swashbuckle" title="for the Swashbuckle swagger tooling in .NET">Swashbuckle</a>
                                
            </span>
        </header>
        <main class="prose laptop:mx-auto">
            <p>I am working on an article for the blog that relies on a C# generated Open API client. I wrote an article on that a few years ago called <a href="https://BaseUrl_1/2021/05/23/generate-csharp-client-for-openapi.html">&quot;Generate C# client for OpenAPI&quot;</a>. So I decided to check if the advice from that post would still be valid today. Combined with the fact that, according to analytics, it is one of my most popular articles to date, this post was born.</p>
<p>The solution provided relied on using an MSBuild task to generate the API on build using a tool called NSwag. However, even back then, in 2021, an alternative was already available. Steve Collins, another dotnet content creator, published an article called <a href="https://stevetalkscode.co.uk/openapireference-commands" class="external">&quot;Using OpenApiReference To Generate Open API Client Code&quot;</a>. The alternative directly adds OpenAPI support to the project while still using NSWag under the hood. Back then, Steve mentioned that there was little documentation, and I was already familiar with doing it manually, so I decided to stick with that. Today I wanted to compare doing it manually or via the built-in mechanism.</p>
<h2 id="safe-openapi-specification-on-build"><a href="#safe-openapi-specification-on-build">Safe OpenAPI specification on build</a></h2>
<p>The purpose of the post is not to detail how to configure an OpenAPI spec for your project since the standard template already supports Swashbuckle. You can find more information on that over <a href="https://learn.microsoft.com/en-us/aspnet/core/tutorials/getting-started-with-swashbuckle?view=aspnetcore-7.0&amp;tabs=visual-studio" class="external">at Microsoft Learn</a>. One thing I like to add to the standard template, is that I want the specification to be part of the project output. We can achieve that with the Swashbuckle CLI, which you can install with the command <code>dotnet tool install --local Swashbuckle.AspNetCore.Cli --version 6.4.0</code>. Note that the version of the CLI must match the version of Swashbuckle used in the API project. After you install the tool, you can modify the csproj to look like this.</p>
<pre><code class="language-xml">&lt;Target Name=&quot;Generate OpenAPI Specification Document&quot; AfterTargets=&quot;Build&quot;&gt;
  &lt;PropertyGroup&gt;
    &lt;OpenApiDocumentName&gt;v1&lt;/OpenApiDocumentName&gt;
    &lt;ApiDll&gt;$(OutputPath)$(AssemblyName).dll&lt;/ApiDll&gt;
    &lt;OutputApiDocument&gt;$(OutputPath)$(AssemblyName).json&lt;/OutputApiDocument&gt;
  &lt;/PropertyGroup&gt;
  &lt;Exec Command=&quot;dotnet swagger tofile --output $(OutputApiDocument) $(ApiDll) $(OpenApiDocumentName)&quot; ContinueOnError=&quot;true&quot; /&gt;
&lt;/Target&gt;
</code></pre>
<p>The <code>swagger</code> command takes the output location (OutputApiDocument), the DLL for the specification (ApiDll) and the document name (OpenAPIDocumentName) as input parameters. The default name of the API document is <code>v1</code>. We use some existing MSBuild properties to populate these parameters, so in our case, <code>OutputPath</code> looks like <code>bin/Debug/net7.0/</code> and <code>AssemblyName</code> is <code>Demo</code>. That means that after the project builds, a file <code>bin/Debug/net7.0/Demo.json</code> will contain our Open API Specification.</p>
<p>Note that as part of the <code>bin</code> folder, the specification is not under source control. Sometimes I place it in the project root to track any changes made to the specification. Doing so is especially useful for monitoring unexpected or unintended changes to the specification.</p>
<h2 id="use-nswag.msbuild-to-generate-a-csharp-client"><a href="#use-nswag.msbuild-to-generate-a-csharp-client">Use NSwag.MSBuild to generate a csharp client</a></h2>
<p>To add NSwag manually to our project, we need the <code>NSwag.MSBuild</code> NuGet package. Which we can install via <code>dotnet add package NSwag.MSBuild --version 13.18.2</code>. The process is mostly the same as I detailed in 2021; one of the few changes is the target framework to use. Modify the csproj as follows:</p>
<pre><code class="language-xml">&lt;Target Name=&quot;NSwag&quot; AfterTargets=&quot;PostBuildEvent&quot; Condition=&quot; '$(Configuration)' == 'Debug' &quot;&gt;
    &lt;!--https://github.com/RicoSuter/NSwag/wiki/NSwag.MSBuild--&gt;
    &lt;!-- &lt;Exec Command=&quot;$(NSwagExe_Net70) new&quot; /&gt; --&gt;
    &lt;PropertyGroup&gt;
      &lt;OpenApiDocument&gt;../../Api/Demo/bin/Debug/net7.0/Demo.json&lt;/OpenApiDocument&gt;
      &lt;NSwagConfiguration&gt;nswag.json&lt;/NSwagConfiguration&gt;
      &lt;GeneratedOutput&gt;Client.g.cs&lt;/GeneratedOutput&gt;
    &lt;/PropertyGroup&gt;
    &lt;Exec Command=&quot;$(NSwagExe_Net70) run $(NSwagConfiguration) /variables:OpenApiDocument=$(OpenApiDocument),GeneratedOutput=$(GeneratedOutput)&quot; /&gt;
&lt;/Target&gt;
</code></pre>
<p>You can uncomment <code>$(NSwagExe_Net70) new</code> to generate a fresh nswag.json, the configuration file used for NSwag. After you have the config file, you still need to specify the runtime, the document, and the output location. Abbreviated the change to the file looks like this:</p>
<pre><code class="language-json">{
  &quot;runtime&quot;: &quot;Net70&quot;,
  &quot;defaultVariables&quot;: null,
  &quot;documentGenerator&quot;: {
    &quot;fromDocument&quot;: {
      &quot;json&quot;: &quot;$(OpenApiDocument)&quot;
    }
  },
  &quot;codeGenerators&quot;: {
     &quot;openApiToCSharpClient&quot;: { 
      // ...
      &quot;output&quot;: &quot;$(GeneratedOutput)&quot;
      // ...
     }
  }
}
</code></pre>
<p>I don't remember it being possible back in 2021, but you can now change the JSON serializer used in the generated client. You can do so by modifying the value of <code>codeGenerators openApiToCSharpClient jsonLibrary</code> to <code>SystemTextJson</code>. If you do not do this, you must install the <code>Newtonsoft.Json</code> package, or the generated code will not compile.</p>
<h2 id="using-openapi-reference"><a href="#using-openapi-reference">Using OpenAPI Reference</a></h2>
<h3 id="using-openapi-reference-from-visual-studio"><a href="#using-openapi-reference-from-visual-studio">Using OpenAPI reference from Visual Studio</a></h3>
<p>I can imagine that people do not like the manual way, especially if you don't know the inner workings of MSBuild; it can feel a bit like magic. Adding an OpenAPI reference via Visual Studio is as simple as right-clicking any project and choosing add connected service.</p>
<p><img src="https://BaseUrl_1/assets/images/posts/20230414/openapi/01_add_service_reference.png" width="1546" height="1000" alt="Microsoft Visual Studio - Add Service reference" /></p>
<p><img src="https://BaseUrl_1/assets/images/posts/20230414/openapi/02_select_service_type.png" width="1443" height="925" alt="Microsoft Visual Studio - Select service reference type" /></p>
<p>By choosing the option &quot;Service reference...&quot; instead of &quot;Connected Service&quot; you get the second prompt immediately. By selecting &quot;Connected service&quot; you get the overview of all connected services for the project and then need an extra click to add the service reference.</p>
<p>We can customize the input for the msbuild task on the third screen. We only need to specify the file location of the Open API JSON.</p>
<p><img src="https://BaseUrl_1/assets/images/posts/20230414/openapi/03_add_openapi.png" width="1547" height="923" alt="Microsoft Visual Studio - Add service reference OpenAPI" /></p>
<p>By selecting &quot;finish&quot;, Visual Studio will make all necessary modifications. Easy right? The project file should now look like this:</p>
<pre><code class="language-xml">&lt;ItemGroup&gt;
  &lt;OpenApiReference Include=&quot;..\..\Api\Demo\bin\Debug\net7.0\Demo.json&quot; 
                    CodeGenerator=&quot;NSwagCSharp&quot;
                    Link=&quot;OpenAPIs\Demo.json&quot; /&gt;
&lt;/ItemGroup&gt;

&lt;ItemGroup&gt;
  &lt;PackageReference Include=&quot;Microsoft.Extensions.ApiDescription.Client&quot; Version=&quot;3.0.0&quot;&gt;
    &lt;PrivateAssets&gt;all&lt;/PrivateAssets&gt;
    &lt;IncludeAssets&gt;runtime; build; native; contentfiles; analyzers; buildtransitive&lt;/IncludeAssets&gt;
  &lt;/PackageReference&gt;
  &lt;PackageReference Include=&quot;Newtonsoft.Json&quot; Version=&quot;13.0.1&quot; /&gt;
  &lt;PackageReference Include=&quot;NSwag.ApiDescription.Client&quot; Version=&quot;13.0.5&quot;&gt;
    &lt;PrivateAssets&gt;all&lt;/PrivateAssets&gt;
    &lt;IncludeAssets&gt;runtime; build; native; contentfiles; analyzers; buildtransitive&lt;/IncludeAssets&gt;
  &lt;/PackageReference&gt;
&lt;/ItemGroup&gt;
</code></pre>
<p>The generated code will be in the <code>obj</code> folder if you build the project. As mentioned above, the API specification is in the <code>Debug/net7.0</code> folder, so it will break if I retarget this solution to a newer framework. That is another reason to just put the specification at the root of the API project.</p>
<h3 id="using-openapi-reference-from-command-line"><a href="#using-openapi-reference-from-command-line">Using OpenAPI reference from command line</a></h3>
<p>You may wonder if it is as simple if you do not have Visual Studio as your IDE. It is; Microsoft published a dotnet tool for this exact reason. You can install it by running <code>dotnet tool install --local Microsoft.dotnet-openapi --version 7.0.4</code>. You can add the API specification by using a terminal from your project's directory and running the following command.</p>
<pre><code class="language-shell">dotnet dotnet-openapi add file ..\..\Api\Demo\bin\Debug\net7.0\Demo.json
</code></pre>
<p>The result looks like this:</p>
<pre><code class="language-xml">&lt;ItemGroup&gt;
  &lt;PackageReference Include=&quot;Newtonsoft.Json&quot; Version=&quot;12.0.2&quot; /&gt;
  &lt;PackageReference Include=&quot;NSwag.ApiDescription.Client&quot; Version=&quot;13.0.5&quot; /&gt;
&lt;/ItemGroup&gt;
&lt;ItemGroup&gt;
  &lt;OpenApiReference Include=&quot;..\..\Api\Demo\bin\Debug\net7.0\Demo.json&quot; /&gt;
&lt;/ItemGroup&gt;
</code></pre>
<p>Yeah, that is right, it is similar but not the same as if done via Visual Studio.</p>
<ul>
<li>The package <code>Microsoft Extensions ApiDescription Client</code> is missing.</li>
<li>The version for NewtonSoft is different.</li>
<li>The CodeGenerator is not specified, and it defaults to <code>NSwagCSharp</code>.
I expected the tool to use the same templates as Visual Studio, but this is not the case. The missing package is still used, but as a transitive dependency of <code>NSwag.ApiDescription.Client</code>, with the installed version it is just a preview build.</li>
</ul>
<p>Do note that it is not required to use the dotnet tool for this; you can manually add the same lines as provided above. The tool is just there for convenience. Documentation for the tool is still somewhat limited but is described at the <a href="https://learn.microsoft.com/en-us/aspnet/core/web-api/microsoft.dotnet-openapi?view=aspnetcore-7.0" class="external">docs</a> over here.</p>
<h3 id="influence-created-output"><a href="#influence-created-output">Influence created output</a></h3>
<p>We have already seen that for the manual approach, making changes to the configuration can be done by modifying the nswag.json, a file we do not have when using OpenApiReference. So this section will go into making the same modification for this version.</p>
<p>Before I go into it, we must fix one issue with the template used so far. There is a glaring issue which only appears if you have built the project in different ways. For example, here is the output building from Visual Studio</p>
<pre><code class="language-shell">1&gt;GenerateNSwagCSharp:
1&gt;  &quot;C:\Users\hamulyak\.nuget\packages\nswag.msbuild\13.0.5\build\../tools/Win/NSwag.exe&quot; openapi2csclient /className:DemoClient /namespace:ConnectedService /input:C:\projects\BlogTopics\MyBlog\src\Api\Demo\bin\Debug\net7.0\Demo.json /output:obj\DemoClient.cs
1&gt;NSwag command line tool for .NET 4.6.1+ WinX64, toolchain v13.0.5.0 (NJsonSchema v10.0.22.0 (Newtonsoft.Json v11.0.0.0))
1&gt;Visit http://NSwag.org for more information.
1&gt;NSwag bin directory: C:\Users\hamulyak\.nuget\packages\nswag.msbuild\13.0.5\tools\Win
1&gt;Code has been successfully written to file.
</code></pre>
<p>Compare that with the output from the dotnet CLI:</p>
<pre><code class="language-shell">  GenerateNSwagCSharp:
    dotnet --roll-forward-on-no-candidate-fx 2 C:\Users\hamulyak\.nuget\packages\nswag.msbuild\13.0.5\build\../tools/NetCore21//dotnet-nswag.dll openapi2csclient /className:DemoClient /na
  mespace:ConnectedService /input:C:\projects\BlogTopics\MyBlog\src\Api\Demo\bin\Debug\net7.0\Demo.json /output:obj\DemoClient.cs
  NSwag command line tool for .NET Core NetCore21, toolchain v13.0.5.0 (NJsonSchema v10.0.22.0 (Newtonsoft.Json v11.0.0.0))
  Visit http://NSwag.org for more information.
  NSwag bin directory: C:\Users\hamulyak\.nuget\packages\nswag.msbuild\13.0.5\tools\NetCore21
  Code has been successfully written to file.
</code></pre>
<p>Do you see the issue? The CLI variant differs from the NSwag version used; it uses a <code>NetCore21</code> dll. We get this behaviour because the templates use an outdated package version. According to NuGet the old version (13.0.5) is downloaded over 2 million times, whereas all other versions do not exceed half a million. After updating, the NSwag version will equal your project's target framework.</p>
<p>Back to the issue at hand, how do we customize the output? It is a mix-match situation. You can modify the Namespace and Client name directly by specifying them as properties on the <OpenApiReference> line like this:</p>
<pre><code class="language-xml">&lt;OpenApiReference Include=&quot;..\..\Api\Demo\bin\Debug\net7.0\Demo.json&quot; 
                  CodeGenerator=&quot;NSwagCSharp&quot; 
                  Namespace=&quot;MyNamespace&quot;
                  ClassName=&quot;MyClient&quot; 
                  Link=&quot;OpenAPIs\Demo.json&quot; /&gt;
</code></pre>
<p>Other options, like the JsonLibrary, need to be formatted differently. Like <code>Namespace</code>, there is an <code>Options</code> attribute. For example, we change the configuration below to use SystemTextJson and provide a custom name for the Exception class in the generated code base.</p>
<pre><code class="language-xml">&lt;OpenApiReference Include=&quot;..\..\Api\Demo\bin\Debug\net7.0\Demo.json&quot; 
                  CodeGenerator=&quot;NSwagCSharp&quot; 
                  Options=&quot;/JsonLibrary:SystemTextJson /ExceptionClass:DemoApiException&quot; 
                  ClassName=&quot;MyClient&quot; 
                  Link=&quot;OpenAPIs\Demo.json&quot; /&gt;
</code></pre>
<p>Any value set by nswag.json can also be provided here in the format <code>/propertyName:value</code>. I like to point out that properties like namespace can not be set here, so the following snippet will not work.</p>
<pre><code class="language-xml">&lt;OpenApiReference 
  Include=&quot;..\..\Api\Demo\bin\Debug\net7.0\Demo.json&quot; 
  CodeGenerator=&quot;NSwagCSharp&quot; 
  Options=&quot;/Namespace:MyNamspace /JsonLibrary:SystemTextJson /ExceptionClass:DemoApiException&quot; 
  ClassName=&quot;MyClient&quot; 
  Link=&quot;OpenAPIs\Demo.json&quot; /&gt;
</code></pre>
<p>The reason is that task creates the following NSwag command (displayed in the output window)</p>
<pre><code class="language-shell">dotnet --roll-forward-on-no-candidate-fx 2 &quot;C:\Users\hamulyak\.nuget\packages\nswag.msbuild\13.18.2\build\../tools/Net70//dotnet-nswag.dll&quot; openapi2csclient /className:MyClient /namespace:Override /input:&quot;C:\projects\BlogTopics\MyBlog\src\Api\Demo\bin\Debug\net7.0\Demo.json&quot; /output:&quot;obj\DemoClient.cs&quot; /Namespace:MyNamspace /JsonLibrary:SystemTextJson /ExceptionClass:DemoApiException
</code></pre>
<p>It has a duplicate <code>/Namespace</code>, and the first wins. The only way to customize the namespace is by providing it as an attribute. Otherwise, the default value, which is the assembly name, will be used.</p>
<h2 id="conclusion"><a href="#conclusion">Conclusion</a></h2>
<p>In conclusion, I cannot deny that the OpenApiReference feels a lot easier than the manual approach. It has its issues. For example, the lack of documentation configuring the generated code is disappointing. I also think it is weird that the different approaches between Visual Studio and command-line are out of sync and that both templates are outdated. It makes me question if people are using it. Both reasons are not a hard no-go for me. The new approach does feel less like magic, but the trade-off for me is that the settings used are less transparent than a nswag.json file. As I showed in the previous version of this article, NSwag can also function without specifying all options and will apply the defaults themselves. I like things to be explicit, so that is a point in favour of the manual approach, that it gives me a choice to specify everything or omit the things I don't need. The abstraction might have been better if we could still provide a config file or if there were properties that Microsoft would map to NSwag stuff internally, decoupling my code generation from the implementation. What do you think about this? Which version do you prefer?</p>
<p>As always, if you have any questions, feel free to reach out. Do you have suggestions or alternatives? I would love to hear about them.</p>
<p>The corresponding source code for this article is on <a href="https://github.com/kaylumah/GenerateCSharpClientForOpenAPIRevisited" class="external">GitHub</a>.</p>
<p>See you next time, stay healthy and happy coding to all 🧸!</p>
<h2 id="additional-resources"><a href="#additional-resources">Additional Resources</a></h2>
<ul>
<li><a href="https://devblogs.microsoft.com/dotnet/generating-http-api-clients-using-visual-studio-connected-services/" class="external">Visual Studio Connected Services</a></li>
</ul>
        </main>
        <footer class="">
            
                        <!-- https://giscus.app -->
                        <!-- https://github.com/giscus/giscus/blob/main/ADVANCED-USAGE.md -->
                        <script src="https://giscus.app/client.js"
                            data-repo="kaylumah/hosting"
                            data-repo-id="MDEwOlJlcG9zaXRvcnkzMzgyNzg4MzU="
                            data-mapping="number"
                            data-term="266"
                            data-reactions-enabled="1"
                            data-emit-metadata="0"
                            data-input-position="top"
                            data-theme="light_high_contrast"
                            data-lang="en"
                            data-loading="lazy"
                            crossorigin="anonymous"
                            async>
                        </script>
                        
        </footer>
    </article>
    <ul id="tiles" class="flex-none flex flex-col items-center gap-4">
        <li class="w-full laptop:w-64">
            <div class="bg-slate-50 border-2 p-6 flex flex-col items-center gap-2">
                <img class="rounded-full h-32 w-32" src="/assets/avatar_background.svg" alt="Kaylumah Hero" />
                <h2 class="text-xl font-semibold">Max Hamulyák</h2>
                <span>aka Kaylumah</span>
            </div>
        </li>
        <li class="w-full laptop:w-64">
            <div class="bg-slate-50 border-2 p-6 flex flex-col items-center gap-2">
                <h2 class="text-xl font-semibold">Sponsors</h2>
                <p>
                    Enjoy reading my content? Consider becoming a sponsor for the blog.
                    This will help keep the blog up and running! 
                </p>
                <ul class="flex flex-row items-center gap-2">
                    <li>
                        <a href="https://www.buymeacoffee.com/kaylumah" target="_blank">
                            <svg class="block h-8 w-8" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none">
                                <!-- https://simpleicons.org -->
                                <title>Buy Me A Coffee</title>
                                <path fill="#FFDD00" d="M20.216 6.415l-.132-.666c-.119-.598-.388-1.163-1.001-1.379-.197-.069-.42-.098-.57-.241-.152-.143-.196-.366-.231-.572-.065-.378-.125-.756-.192-1.133-.057-.325-.102-.69-.25-.987-.195-.4-.597-.634-.996-.788a5.723 5.723 0 00-.626-.194c-1-.263-2.05-.36-3.077-.416a25.834 25.834 0 00-3.7.062c-.915.083-1.88.184-2.75.5-.318.116-.646.256-.888.501-.297.302-.393.77-.177 1.146.154.267.415.456.692.58.36.162.737.284 1.123.366 1.075.238 2.189.331 3.287.37 1.218.05 2.437.01 3.65-.118.299-.033.598-.073.896-.119.352-.054.578-.513.474-.834-.124-.383-.457-.531-.834-.473-.466.074-.96.108-1.382.146-1.177.08-2.358.082-3.536.006a22.228 22.228 0 01-1.157-.107c-.086-.01-.18-.025-.258-.036-.243-.036-.484-.08-.724-.13-.111-.027-.111-.185 0-.212h.005c.277-.06.557-.108.838-.147h.002c.131-.009.263-.032.394-.048a25.076 25.076 0 013.426-.12c.674.019 1.347.067 2.017.144l.228.031c.267.04.533.088.798.145.392.085.895.113 1.07.542.055.137.08.288.111.431l.319 1.484a.237.237 0 01-.199.284h-.003c-.037.006-.075.01-.112.015a36.704 36.704 0 01-4.743.295 37.059 37.059 0 01-4.699-.304c-.14-.017-.293-.042-.417-.06-.326-.048-.649-.108-.973-.161-.393-.065-.768-.032-1.123.161-.29.16-.527.404-.675.701-.154.316-.199.66-.267 1-.069.34-.176.707-.135 1.056.087.753.613 1.365 1.37 1.502a39.69 39.69 0 0011.343.376.483.483 0 01.535.53l-.071.697-1.018 9.907c-.041.41-.047.832-.125 1.237-.122.637-.553 1.028-1.182 1.171-.577.131-1.165.2-1.756.205-.656.004-1.31-.025-1.966-.022-.699.004-1.556-.06-2.095-.58-.475-.458-.54-1.174-.605-1.793l-.731-7.013-.322-3.094c-.037-.351-.286-.695-.678-.678-.336.015-.718.3-.678.679l.228 2.185.949 9.112c.147 1.344 1.174 2.068 2.446 2.272.742.12 1.503.144 2.257.156.966.016 1.942.053 2.892-.122 1.408-.258 2.465-1.198 2.616-2.657.34-3.332.683-6.663 1.024-9.995l.215-2.087a.484.484 0 01.39-.426c.402-.078.787-.212 1.074-.518.455-.488.546-1.124.385-1.766zm-1.478.772c-.145.137-.363.201-.578.233-2.416.359-4.866.54-7.308.46-1.748-.06-3.477-.254-5.207-.498-.17-.024-.353-.055-.47-.18-.22-.236-.111-.71-.054-.995.052-.26.152-.609.463-.646.484-.057 1.046.148 1.526.22.577.088 1.156.159 1.737.212 2.48.226 5.002.19 7.472-.14.45-.06.899-.13 1.345-.21.399-.072.84-.206 1.08.206.166.281.188.657.162.974a.544.544 0 01-.169.364zm-6.159 3.9c-.862.37-1.84.788-3.109.788a5.884 5.884 0 01-1.569-.217l.877 9.004c.065.78.717 1.38 1.5 1.38 0 0 1.243.065 1.658.065.447 0 1.786-.065 1.786-.065.783 0 1.434-.6 1.499-1.38l.94-9.95a3.996 3.996 0 00-1.322-.238c-.826 0-1.491.284-2.26.613z"/>
                            </svg>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/sponsors/kaylumah" target="_blank">
                            <svg class="block h-8 w-8" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none">
                                <!-- https://simpleicons.org -->
                                <title>GitHub Sponsors</title>
                                <path fill="#EA4AAA" d="M17.625 1.499c-2.32 0-4.354 1.203-5.625 3.03-1.271-1.827-3.305-3.03-5.625-3.03C3.129 1.499 0 4.253 0 8.249c0 4.275 3.068 7.847 5.828 10.227a33.14 33.14 0 0 0 5.616 3.876l.028.017.008.003-.001.003c.163.085.342.126.521.125.179.001.358-.041.521-.125l-.001-.003.008-.003.028-.017a33.14 33.14 0 0 0 5.616-3.876C20.932 16.096 24 12.524 24 8.249c0-3.996-3.129-6.75-6.375-6.75zm-.919 15.275a30.766 30.766 0 0 1-4.703 3.316l-.004-.002-.004.002a30.955 30.955 0 0 1-4.703-3.316c-2.677-2.307-5.047-5.298-5.047-8.523 0-2.754 2.121-4.5 4.125-4.5 2.06 0 3.914 1.479 4.544 3.684.143.495.596.797 1.086.796.49.001.943-.302 1.085-.796.63-2.205 2.484-3.684 4.544-3.684 2.004 0 4.125 1.746 4.125 4.5 0 3.225-2.37 6.216-5.048 8.523z"/>
                            </svg>
                        </a>
                    </li>
                </ul>
            </div>
        </li>
        <li class="w-full laptop:w-64">
            
            
            
            <div class="bg-slate-50 border-2 p-6 flex flex-col items-center gap-2">
                <h2 class="text-xl font-semibold">Popular posts</h2>
                <ul class="flex flex-col gap-2">
                    
                            <li>
                                <a href="/2021/04/11/an-approach-to-writing-mocks.html">Experiment with Moq, an approach to writing mocks</a>
                            </li>
                            
                            <li>
                                <a href="/2019/09/07/using-csharp-code-your-git-hooks.html">Using C# code in your git hooks</a>
                            </li>
                            
                </ul>
            </div>

        </li>
        <li class="w-full laptop:w-64">
            
            
            
        </li>
        <li class="w-full laptop:w-64">
            <div class="bg-slate-50 border-2 p-6 flex flex-col items-center gap-2">
                <h2 class="text-xl font-semibold">Tags</h2>
                <ul id="word-cloud" class="flex justify-center flex-wrap align-center gap-2 leading-8">
                </ul>
                <script>
                var words = [
              {
                "Id": "azure",
                "DisplayName": "Azure",
                "Size": 2
              },
              {
                "Id": "code-quality",
                "DisplayName": "Code Quality",
                "Size": 1
              },
              {
                "Id": "configuration",
                "DisplayName": "Configuration",
                "Size": 1
              },
              {
                "Id": "csharp",
                "DisplayName": "C#",
                "Size": 9
              },
              {
                "Id": "git",
                "DisplayName": "Git",
                "Size": 1
              },
              {
                "Id": "moq",
                "DisplayName": "Moq",
                "Size": 1
              },
              {
                "Id": "msbuild",
                "DisplayName": "MSBuild",
                "Size": 2
              },
              {
                "Id": "nswag",
                "DisplayName": "NSwag",
                "Size": 2
              },
              {
                "Id": "nuget",
                "DisplayName": "NuGet",
                "Size": 1
              },
              {
                "Id": "openapi",
                "DisplayName": "OpenAPI",
                "Size": 2
              },
              {
                "Id": "reqnroll",
                "DisplayName": "Reqnroll",
                "Size": 1
              },
              {
                "Id": "rider",
                "DisplayName": "Rider",
                "Size": 1
              },
              {
                "Id": "swashbuckle",
                "DisplayName": "Swashbuckle",
                "Size": 2
              },
              {
                "Id": "testing",
                "DisplayName": "Testing",
                "Size": 4
              },
              {
                "Id": "visualstudio",
                "DisplayName": "Visual Studio",
                "Size": 1
              },
              {
                "Id": "visualstudio2019",
                "DisplayName": "Visual Studio 2019",
                "Size": 1
              },
              {
                "Id": "vscode",
                "DisplayName": "VS Code",
                "Size": 1
              },
              {
                "Id": "xunit",
                "DisplayName": "Xunit",
                "Size": 2
              }
            ];
                
                var container = document.getElementById('word-cloud');
                words.forEach(word => {
                  const li = document.createElement('li');
                  const anchor = document.createElement('a');
                  anchor.href = "/blog.html?tag=" + word.Id;
                  anchor.text = `${word.DisplayName} (${word.Size})`;
                  const x = word.Size;
                  switch(true)
                  {
                    case (x < 2):
                      anchor.classList = "text-md"//; text-gray-500";
                      break;
                    case (x < 4):
                      anchor.classList = "text-lg"//; text-blue-500";
                      break;
                    case (x < 6):
                      anchor.classList = "text-xl"//; text-red-500";
                      break;
                    default:
                      anchor.classList = "text-2xl"//; text-green-500";
                      break;
                  }
                
                  li.appendChild(anchor);
                  container.appendChild(li);
                });  
                </script>
            </div>
        </li>
    </ul>
</div>

        </main>
        <footer class="bg-gray-900 p-4">
            <div class="flex flex-col text-center text-gray-100">
                <span data-testid="Footer-CopyrightNotice">© Kaylumah. All rights reserved.</span>
                <!-- <span class="text-xs">Deployed from commit <a data-testid="FooterLink-CommitId" class="hover:text-gray-400" href="https://github.com/kaylumah/hosting/commit/[COMMIT-HASH]">[SHORT-COMMIT-HASH]</a> via build <a data-testid="FooterLink-BuildId" class="hover:text-gray-400" href="https://github.com/kaylumah/hosting/actions/runs/[BUILD-ID]">BuildNumber_1</a></span> -->
            </div>
        </footer>
        <div id="cookie-banner" class="fixed inset-x-0 bottom-0 z-10 flex flex-col justify-between gap-x-8 gap-y-4 bg-white p-6 tablet:flex-row tablet:items-center laptop:px-8">
            <p class="text-sm leading-6 text-gray-900">This website uses cookies to enhance your browsing experience, analyze site traffic, and serve better user experiences. By continuing to use this site, you consent to our use of cookies. Learn more in our <a class="font-semibold text-teal-600" href="/privacy">cookie policy</a>.</p>
            <div class="mr-16 flex flex-none items-center gap-x-5">
                <button onclick="handleCookieConsentGranted()" type="button" class="rounded-md bg-gray-900 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-700">Accept all</button>
                <button onclick="handleCookieConsentDenied()" type="button" class="text-sm font-semibold leading-6 text-gray-900">Reject all</button>
            </div>
            <script>

                window.hideCookieBanner = function() {
                    let cookieBanner = document.getElementById("cookie-banner");
                    cookieBanner.classList.toggle("hidden");
                }
    
                window.handleCookieConsentGranted = function() {
                  window.setCookieConsent("granted");
                  window.setGtagConsentStatus("update", "granted");
                  window.hideCookieBanner();
                }
              
                window.handleCookieConsentDenied = function() {
                    window.setCookieConsent("denied");
                    window.setGtagConsentStatus("update", "denied");
                    window.hideCookieBanner();
                }
    
                let hideCookieBanner = window.getCookieConsent() != "unknown";
                if (hideCookieBanner)
                {
                    window.hideCookieBanner();
                }
              
            </script>
        </div>
    </div>
</body>

</html>