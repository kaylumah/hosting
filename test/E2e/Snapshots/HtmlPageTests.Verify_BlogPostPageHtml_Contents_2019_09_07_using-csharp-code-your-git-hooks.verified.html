<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="icon" href="/assets/images/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png" />
    <link rel="manifest" href="/assets/images/site.webmanifest" />
    <link rel="mask-icon" href="/assets/images/safari-pinned-tab.svg" color="DarkGreen" />

    <link href="/compiled.css?v=[SHORT-COMMIT-HASH]" rel="stylesheet" />

    <!-- Begin Kaylumah SEO tag v[SHORT-COMMIT-HASH] -->
    
    <!-- Common Meta Tags -->
    <title>Using C# code in your git hooks</title>
    <link rel="canonical" href="https://BaseUrl_1/2019/09/07/using-csharp-code-your-git-hooks.html" />
    <link rel="alternate" type="application/atom+xml" href="https://BaseUrl_1/feed.xml" title="Max Hamulyák · Kaylumah RSS Feed" />
    <link rel="sitemap" type="application/xml" href="https://BaseUrl_1/sitemap.xml" title="Max Hamulyák · Kaylumah Sitemap" />
    <meta name="generator" content="Kaylumah v[SHORT-COMMIT-HASH]" />
    <meta name="description" content="Getting started with C# script in your client-side git hooks" />
    <meta name="copyright" content="© Kaylumah. All rights reserved." />
    <meta name="keywords" content="csharp, git" />
    
    <!-- OpenGraph Meta Tags -->
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en" />
    <meta property="og:site_name" content="Max Hamulyák · Kaylumah" />
    <meta property="og:title" content="Using C# code in your git hooks" />
    <meta property="og:url" content="https://BaseUrl_1/2019/09/07/using-csharp-code-your-git-hooks.html" />
    <meta property="og:description" content="Getting started with C# script in your client-side git hooks" />
    <meta property="og:image" content="https://BaseUrl_1/assets/images/posts/20190907/githooks/cover_image.png" />
    <meta property="article:author" content="Max Hamulyák" />
    <meta property="article:published_time" content="2019-09-07T00:00:00.0000000+02:00" />
    <meta property="article:modified_time" content="2021-03-21T00:00:00.0000000+01:00" />
    <meta property="article:tag" content="csharp" />
    <meta property="article:tag" content="git" />
    
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Using C# code in your git hooks" />
    <meta name="twitter:description" content="Getting started with C# script in your client-side git hooks" />
    <meta name="twitter:image" content="https://BaseUrl_1/assets/images/posts/20190907/githooks/cover_image.png" />
    <meta name="twitter:site" content="@kaylumah" />
    <meta name="twitter:creator" content="@kaylumah" />
    
    <!-- Mastodon Meta Tags -->
    <link rel="me" href="https://mastodon.nl/@kaylumah" />
    
    <!-- Kaylumah BuildInfo Meta Tags -->
    <meta property="kaylumah:copyright" content="© Kaylumah. All rights reserved." />
    <meta property="kaylumah:commit" content="[COMMIT-HASH]" />
    <meta property="kaylumah:version" content="1.0.0.BuildNumber_1" />
    <meta property="kaylumah:buildId" content="[BUILD-ID]" />
    <meta property="kaylumah:buildNumber" content="BuildNumber_1" />
    <meta property="kaylumah:time" content="DateTimeOffset_1" />
    <meta property="kaylumah:site" content="Guid_1" />
    <meta property="kaylumah:page" content="Guid_2" />
    
    <!-- LdJson Meta Tags -->
    <script type="application/ld+json">{
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "description": "Getting started with C# script in your client-side git hooks",
      "image": "https://BaseUrl_1/assets/images/posts/20190907/githooks/cover_image.png",
      "mainEntityOfPage": "https://BaseUrl_1/2019/09/07/using-csharp-code-your-git-hooks.html",
      "url": "https://BaseUrl_1/2019/09/07/using-csharp-code-your-git-hooks.html",
      "author": {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Max Hamulyák",
        "image": "https://BaseUrl_1/assets/avatar_background.svg",
        "sameAs": [
          "https://www.linkedin.com/in/maxhamulyak",
          "https://twitter.com/kaylumah"
        ],
        "email": "max@kaylumah.nl"
      },
      "dateModified": "2021-03-21T00:00:00+01:00",
      "datePublished": "2019-09-07T00:00:00+02:00",
      "headline": "Using C# code in your git hooks",
      "inLanguage": "en",
      "keywords": "csharp,git",
      "publisher": {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "kaylumah",
        "sameAs": "https://www.linkedin.com/company/kaylumah",
        "foundingDate": "2020-01-01",
        "logo": "https://BaseUrl_1/assets/logo.svg"
      },
      "timeRequired": "PT6M",
      "wordCount": 1407
    }</script>
    
    <!-- End Kaylumah SEO tag -->
    <!--
                                                        
       _  __           _                       _        
      | |/ /__ _ _   _| |_   _ _ __ ___   __ _| |__     
      | ' // _` | | | | | | | | '_ ` _ \ / _` | '_ \    
      | . \ (_| | |_| | | |_| | | | | | | (_| | | | |   
      |_|\_\__,_|\__, |_|\__,_|_| |_| |_|\__,_|_| |_|   
                 |___/                                  
                                                        
     You found 🧸                                      
                                                       
    -->
    
    <script>
    
      const consoleSignatureText = '%c👨‍💻 Thank you for your visit to my little spot on the internet, be welcome! 🧸';
      const consoleSignatureStyle = `
      font-size: 16px;
      background: #4cae50;
      color: white;
      text-align: center;
      padding: 10px 15px;
      width: 100%;
      border-radius: 20px;
    `;
      console.log(consoleSignatureText, consoleSignatureStyle);
    </script>
    <script>
      window.getCookieConsent = function() {
          try {
              const consent = document.cookie.match(/cookie-consent=([^;]+)/)[1];
              return consent;
          } catch (error) {
              console.log("failed to retrieve consent", error);
              return "unknown";
          }
      };
    
      window.setCookieConsent = function(status) {
    
        if (status != "denied" && status != "granted") {
          throw new Error(`Status ${status} is not supported!`);
        }
    
        let today = new Date();
        let expiryDate = new Date(today.getFullYear() + 1, today.getMonth(), today.getDate());
        document.cookie = `cookie-consent=${status}; expires=${expiryDate}; path=/`;
      }
    
    </script>
    <script>
      // Define dataLayer and the gtag function.
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
    
      window.setGtagConsentStatus = function(mode, status) {
    
        if (mode != "update" && mode != "default") {
          throw new Error(`Mode ${mode} is not supported!`);
        }
    
        if (status != "denied" && status != "granted") {
          throw new Error(`Status ${status} is not supported!`);
        }
    
        gtag('consent', mode, {
          'ad_storage': status,
          'ad_user_data': status,
          'ad_personalization': status,
          'analytics_storage': status
        });
      }
    
      let currentStatus = window.getCookieConsent();
      let cookiesAllowed = currentStatus == "granted";
    
      if (cookiesAllowed) {
        console.log("cookies already approved");
        window.setGtagConsentStatus("default", "granted");
      } else {
        console.log("assume cookies are denied");
        window.setGtagConsentStatus("default", "denied");
      }
    </script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MEQZVWN0D7">
    </script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
    
      gtag('js', new Date());
      gtag('config', 'G-MEQZVWN0D7');
    </script>
</head>

<body class="bg-gray-100 antialiased">
    <div class="flex flex-col h-screen">
        <header class="bg-gray-900">
            <nav class="flex flex-wrap items-center justify-between p-4">
                <a data-testid="NavLink-Home" href="/" rel="home">
                    <img data-testid="NavLogo" class="h-12 w-20" height="48" width="80" src="/assets/logo.svg" alt="Kaylumah" />
                </a>
                <button id="hamburger" class="tablet:hidden p-2 rounded-md text-gray-100 hover:text-gray-400 hover:bg-gray-500">
                    <span class="sr-only">Open main menu</span>
                    <svg class="toggle block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                    <svg class="toggle hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
                <ul class="toggle hidden tablet:flex w-full tablet:w-auto text-right text-bold mt-5 tablet:mt-0 border-t-2 border-gray-600 tablet:border-none">
                    
                                        <li>
                                            <a data-testid="NavLink-About" href="/about.html" class="block tablet:inline-block text-gray-100 hover:text-gray-400 px-3 py-3 border-b-2 border-gray-600 tablet:border-none">
                                                About
                                            </a>
                                        </li>
                                        
                                        <li>
                                            <a data-testid="NavLink-Blog" href="/blog.html" class="block tablet:inline-block text-gray-100 hover:text-gray-400 px-3 py-3 border-b-2 border-gray-600 tablet:border-none">
                                                Blog
                                            </a>
                                        </li>
                                        
                </ul>
            </nav>
            <script>
                document.getElementById('hamburger').onclick = function toggleMenu() {
                    const navToggle = document.getElementsByClassName('toggle');
                    for (let i = 0; i < navToggle.length; i++) {
                        navToggle.item(i).classList.toggle('hidden');
                    }
                };
            </script>
        </header>
        <main class="flex-1 p-4 text-gray-900">
            <div class="flex flex-col gap-8 laptop:flex-row">
    <article id="blogContents" class="flex-1 bg-slate-50 border-2 p-6 flex flex-col gap-8">
        <header class="prose laptop:mx-auto">
            <picture class="hidden">
                <source type="image/webp" srcset="/assets/images/posts/20190907/githooks/cover_image.png.webp">
                <img loading="lazy" src="/assets/images/posts/20190907/githooks/cover_image.png" alt="cover for Using C# code in your git hooks" height="640" width="1280" />
            </picture>
            <h1>Using C# code in your git hooks</h1>
            <div class="flex flex-row gap-4">
                <time datetime="2019-09-07">2019/09/07</time>
                <span>Max Hamulyák</span>
                <span>6 minute</span>
            </div>
            <span class="flex flex-row gap-4">
                
                                <a href="/blog.html?tag=csharp" title="for the C# programming language">C#</a>
                                
                                <a href="/blog.html?tag=git" title="for the Git version control system">Git</a>
                                
            </span>
        </header>
        <main class="prose laptop:mx-auto">
            <h2 id="why-use-hooks"><a href="#why-use-hooks">Why use hooks?</a></h2>
<p>We, as developers, love platforms like GitHub, GitLab, Atlassian, Azure DevOps etc., as our managed git system and collaboration platform. We also love clean code and keep inventing new linters and rules to enforce it. In my opinion, every commit should allow the codebase to deploy to production. There is nothing worse than commits like “fixed style errors” or “fixed build”. These are often small mistakes you want to know as early as possible in your development cycle. You don’t want to break the build for the next developer because he pulled your ‘mistake’ or waste precious build minutes of your CI server. Say you have asked your teammate to review your code; in the meantime, the build server rejects your code. That means you have to go back and fix this, and your teammate has to come back and possibly review again after the changes (i.e., approvals reset on new commit). Doing so would waste a lot of time and effort.</p>
<blockquote>
<p><strong>note</strong>: I favour server-side hooks, but when using a SaaS solution, this is not always a possibility. I know I would not want someone to run arbitrary code on my servers. Unfortunately, a developer can bypass the client-side hooks. Until we can run, possibly sandboxed, server-side hooks on our prefered platform, we have to make the best of it by using client-side hooks.</p>
</blockquote>
<p>Githooks are scripts that can execute on certain parts of the git lifecycle. Hooks must be executable, but other than that, hooks' power is only limited to the developer's imagination. I have seen many samples of hooks written in JavaScript (node) using tools like <a href="https://github.com/typicode/husky" class="external">husky</a> and <a href="https://github.com/conventional-changelog/commitlint" class="external">commitlint</a> to enforce a certain way of working. When I was browsing the changes in the upcoming .NET Core 3.0 release, the concept of <a href="https://docs.microsoft.com/en-us/dotnet/core/whats-new/dotnet-core-3-0#local-dotnet-tools" class="external">local-tools</a> got me thinking. I knew of the existence of <a href="https://www.hanselman.com/blog/CAndNETCoreScriptingWithTheDotnetscriptGlobalTool.aspx" class="external">dotnet-script</a>, would that make it possible to C# in my GitHooks?</p>
<blockquote>
<p><strong>note</strong>: in the past I have used a set-up with node since I occasionally work with front-end frameworks like Angular. Since I had node installed I could use it even in my pure backend projects to enforce commit messages and such. For me it felt dirty, since that would require team members to have node installed. Using the dotnet cli feels less as a forced decision since members are likely to have it installed already.</p>
</blockquote>
<h2 id="lets-get-started"><a href="#lets-get-started">Let’s get started!</a></h2>
<p>When creating a git repository there is a folder called hooks where all the git hooks are placed. For every event there is a sample post-fixed with .sample that shows the possibility of each hook. This directory is not under source control and we are going to create our own directory to be able to share the hooks with the team.</p>
<pre><code class="language-bash">mkdir git-hooks-example  
cd git-hooks-example  
git init  
dotnet new gitignore  
dotnet new tool-manifest  
dotnet tool install dotnet-script  
dotnet tool install dotnet-format  
mkdir .githooks
</code></pre>
<h3 id="pre-commit-hook"><a href="#pre-commit-hook">Pre-Commit Hook</a></h3>
<p>To demonstrate we are going to create a plain hook. To check if it is working <strong>git commit -m “”</strong> (using empty commit message will abort the commit). You should see the line pre-commit hook printed.</p>
<pre><code class="language-csharp">#!/usr/bin/env dotnet dotnet-script
Console.WriteLine(&quot;pre-commit hook&quot;);
</code></pre>
<p>To make it executable run:</p>
<pre><code class="language-bash">find .git/hooks -type f -exec rm {} \;
find .githooks -type f -exec chmod +x {} \;
find .githooks -type f -exec ln -sf ../../{} .git/hooks/ \;
</code></pre>
<p>Since we can reference other files (and even load nuget packages) in our csx we will first create a couple of files so we can have code-reuse between the hooks.</p>
<p>Create a file called <strong>logger.csx</strong></p>
<pre><code class="language-csharp">public class Logger
{
    public static void LogInfo(string message)
    {
        Console.ForegroundColor = ConsoleColor.White;
        Console.Error.WriteLine(message);
    }
    public static void LogError(string message)
    {
        Console.ForegroundColor = ConsoleColor.Red;
        Console.Error.WriteLine(message);
    }
}
</code></pre>
<p>Create a file called <strong>command-line.csx</strong></p>
<pre><code class="language-csharp">#load &quot;logger.csx&quot;
public class CommandLine
{
    public static string Execute(string command)
    {
        // according to: https://stackoverflow.com/a/15262019/637142
        // thans to this we will pass everything as one command
        command = command.Replace(&quot;\&quot;&quot;, &quot;\&quot;\&quot;&quot;);
        var proc = new Process
        {
            StartInfo = new ProcessStartInfo
            {
                FileName = &quot;/bin/bash&quot;,
                Arguments = &quot;-c \&quot;&quot; + command + &quot;\&quot;&quot;,
                UseShellExecute = false,
                RedirectStandardOutput = true,
                CreateNoWindow = true
            }
        };
        proc.Start();
        proc.WaitForExit();
        if (proc.ExitCode != 0)
        {
            Logger.LogError(proc.StandardOutput.ReadToEnd());
            return proc.ExitCode.ToString();
        }
        return proc.StandardOutput.ReadToEnd();
    }
}
</code></pre>
<p>Create a file called <strong>dotnet-commands.csx</strong></p>
<pre><code class="language-csharp">#load &quot;logger.csx&quot;
#load &quot;command-line.csx&quot;
public class DotnetCommands
{
    public static int FormatCode() =&gt; ExecuteCommand(&quot;dotnet format&quot;);
    public static int BuildCode() =&gt; ExecuteCommand(&quot;dotnet build&quot;);

    public static int TestCode() =&gt; ExecuteCommand(&quot;dotnet test&quot;);

    private static int ExecuteCommand(string command)
    {
        string response = CommandLine.Execute(command);
        Int32.TryParse(response, out int exitCode);
        return exitCode;
    }

}
</code></pre>
<p>Create a file called <strong>git-commands.csx</strong></p>
<pre><code class="language-csharp">#load &quot;logger.csx&quot;
#load &quot;command-line.csx&quot;
public class GitCommands
{
    public static void StashChanges()
    {
        CommandLine.Execute(&quot;git stash -q --keep-index&quot;);
    }
    public static void UnstashChanges()
    {
        CommandLine.Execute(&quot;git stash pop -q&quot;);
    }
}
</code></pre>
<p>We now have a utility in place for Logging and running GIT and dotnet commands. Next we are going to start with out pre-commit hook. Create a file called <strong>pre-commit</strong> The difference between this file and the others we just made is that we don’t specify the extension, and that using Shebang we explicitly load dotnet-script. For an explanation of each hook see the article posted below.</p>
<p><a href="https://www.atlassian.com/git/tutorials/git-hooks" class="external">Git Hooks | Atlassian Git Tutorial</a></p>
<pre><code class="language-csharp">#!/usr/bin/env dotnet dotnet-script
#load &quot;logger.csx&quot;
#load &quot;git-commands.csx&quot;
#load &quot;dotnet-commands.csx&quot;

// We'll only runchecks on changes that are a part of this commit so let's stash others
GitCommands.StashChanges();

int buildCode = DotnetCommands.BuildCode();

// We're done with checks, we can unstash changes
GitCommands.UnstashChanges();
if (buildCode != 0) {
    Logger.LogError(&quot;Failed to pass the checks&quot;);
    Environment.Exit(-1);
}
// All checks have passed
</code></pre>
<p>If we run <strong>git commit -m “”</strong> again this time we get an error saying Failed to pass the checks, which makes sense since we don’t have a project yet. We are going to create a simple sln consisting of a classlibary and a test libary.</p>
<pre><code class="language-bash">dotnet new sln  
dotnet new classlib --framework netstandard2.1 --langVersion 8 --name SomeLib --output src/SomeLib  
dotnet new xunit --output tests/SomeLibTests  
dotnet sln add **/*.csproj 
cd tests/SomeLibTests/  
dotnet add reference ../../src/SomeLib/SomeLib.csproj  
cd ../../  
dotnet build
</code></pre>
<p>If we use git commit -m “” one more time, we get the message about aborting the commit again. We now know that every commit will at least compile :-) If for example we remove the namespace ending curly brace from Class1 we get the error <strong>Class1.cs(7,6): error CS1513: }</strong>. If we extend our pre-commit hook even further we can have <a href="https://www.hanselman.com/blog/EditorConfigCodeFormattingFromTheCommandLineWithNETCoresDotnetFormatGlobalTool.aspx" class="external">dotnet-format</a> and dotnet-test running on every commit. If we purposely write a failing test (1 equals 0 or something like that) the build won’t pass.</p>
<pre><code class="language-csharp">#!/usr/bin/env dotnet dotnet-script
#load &quot;logger.csx&quot;
#load &quot;git-commands.csx&quot;
#load &quot;dotnet-commands.csx&quot;

Logger.LogInfo(&quot;pre-commit hook&quot;);

// We'll only runchecks on changes that are a part of this commit so let's stash others
GitCommands.StashChanges();

int formatCode = DotnetCommands.FormatCode();
int buildCode = DotnetCommands.BuildCode();
int testCode = DotnetCommands.TestCode();

// We're done with checks, we can unstash changes
GitCommands.UnstashChanges();
int exitCode = formatCode + buildCode + testCode;
if (exitCode != 0) {
    Logger.LogError(&quot;Failed to pass the checks&quot;);
    Environment.Exit(-1);
}
// All checks have passed
</code></pre>
<h3 id="prepare-commit-message-hook"><a href="#prepare-commit-message-hook">Prepare-commit-message hook</a></h3>
<p>Thus far, we have not really used anything we need C# for; Admittedly we are using C# to execute shell commands. For our next hook we are going to use System.IO. Imagine as a team you have a commit-message convention. Let's say you want each commit message to include a reference to your issue tracker.</p>
<pre><code class="language-text">type(scope?): subject  #scope is optional
</code></pre>
<p>Create a file <strong>prepare-commit-msg</strong> in this hook we can provide a convenient commit message place holder if the user did not supply a message. To actual enforce the message, you need the <strong>commit-msg</strong> hook. In this example, we only create a message for feature branches.</p>
<pre><code class="language-csharp">#!/usr/bin/env dotnet dotnet-script
#load &quot;logger.csx&quot;
#load &quot;util.csx&quot;
#load &quot;git-commands.csx&quot;

Logger.LogInfo(&quot;prepare-commit-msg hook&quot;);

string commitMessageFilePath = Util.CommandLineArgument(Args, 0);
string commitType = Util.CommandLineArgument(Args, 1);
string commitHash = Util.CommandLineArgument(Args, 2);

if (commitType.Equals(&quot;message&quot;)) {
    // user supplied a commit message, no need to prefill.
    Logger.LogInfo(&quot;commitType message&quot;);
    Environment.Exit(0);
}

string[] files = GitCommands.ChangedFiles();
for(int i = 0; i &lt; files.Length; i++) {
    // perhaps determine scope based on what was changed.
    Logger.LogInfo(files[i]);
}

string branch = GitCommands.CurrentBranch();
if (branch.StartsWith(&quot;feature&quot;)) {
    string messageToBe = &quot;feat: ISS-XXX&quot;;
    PrepareCommitMessage(commitMessageFilePath, messageToBe);
}

public static void PrepareCommitMessage(string messageFile, string message)
{
     string tempfile = Path.GetTempFileName();
    using (var writer = new StreamWriter(tempfile))
    using (var reader = new StreamReader(messageFile))
    {
        writer.WriteLine(message);
        while (!reader.EndOfStream)
            writer.WriteLine(reader.ReadLine());
    }
    File.Copy(tempfile, messageFile, true);
}
</code></pre>
<p>Create a new helper called <strong>util.csx</strong></p>
<pre><code class="language-csharp">public class Util
{
    public static string CommandLineArgument(IList&lt;string&gt; Args, int position)
    {
        if (Args.Count() &gt;= position + 1)
        {
            return Args[position];
        }
        return string.Empty;
    }

}
</code></pre>
<h3 id="commit-msg-hook"><a href="#commit-msg-hook">Commit-msg Hook</a></h3>
<p>The final local git hook I took for a spin is the commit-msg hook. It uses a regex to make sure the commit message is according the specified format.</p>
<pre><code class="language-csharp">#!/usr/bin/env dotnet dotnet-script
#load &quot;logger.csx&quot;
#load &quot;util.csx&quot;
#load &quot;git-commands.csx&quot;
using System.Text.RegularExpressions;

Logger.LogInfo(&quot;commit-msg hook&quot;);

string commitMessageFilePath = Util.CommandLineArgument(Args, 0);
string branch = GitCommands.CurrentBranch();
Logger.LogInfo(commitMessageFilePath);
Logger.LogInfo(branch);
string message = GetCommitedMessage(commitMessageFilePath);
Logger.LogInfo(message);

const string regex = @&quot;\b(feat|bug)\b(\({1}\b(core)\b\){1})?(:){1}(\s){1}(ISS-[0-9]{0,3}){1}&quot;;
var match = Regex.Match(message, regex);

if (!match.Success) {
    Logger.LogError(&quot;Message does not match commit format&quot;);
    Environment.Exit(1);
}

public static string GetCommitedMessage(string filePath) {
    return File.ReadAllLines(filePath)[0];
}
</code></pre>
<h3 id="pre-push-hook"><a href="#pre-push-hook">pre push Hook</a></h3>
<p>It is even possible to use NuGet packages in our hooks. Let say we want to prevent pushes to master (perhaps not even commits?). We can read a config file using Newtonsoft.Json and look for a protected branch and abort.</p>
<pre><code class="language-csharp">#!/usr/bin/env dotnet dotnet-script
#r &quot;nuget: Newtonsoft.Json, 12.0.2&quot;
#load &quot;logger.csx&quot;
#load &quot;config.csx&quot;
#load &quot;git-commands.csx&quot;
using Newtonsoft.Json;

string currentBranch = GitCommands.CurrentBranch().Trim();
Config currentConfig = GetConfig();
bool lockedBranch = currentConfig.ProtectedBranches.Contains(currentBranch);

if (lockedBranch) {
    Logger.LogError($&quot;Trying to commit on protected branch '{currentBranch}'&quot;);
    Environment.Exit(1);
}

public static Config GetConfig()
{
    return JsonConvert.DeserializeObject&lt;Config&gt;(File.ReadAllText(&quot;.githooks/config.json&quot;));
}
</code></pre>
<h2 id="conclusion"><a href="#conclusion">Conclusion</a></h2>
<p>My current hooks are far from the best, and perhaps C# is not the fastest language to use in git hook. I do, however consider the experiment a success. I much rather code in C# than in shell script. Ideas for further improvement include</p>
<ul>
<li>based on the list of changes, determine the scope of the change (i.e. only one directory changed we might know the scope)</li>
<li>configure the regex, allowed scopes, allowed types</li>
<li>improve pre-commit-msg for more scenarios</li>
<li>enforce users to use the hooks</li>
<li>managing versions of the hooks, on checkout old / different version of pull (with an update of the hooks) sync the directory. <a href="https://www.viget.com/articles/two-ways-to-share-git-hooks-with-your-team/" class="external">(perhaps githook location)</a></li>
</ul>
<p>Let me know what you think :-)</p>
<p><a href="https://github.com/maxhamulyak/git-hooks-example" class="external">maxhamulyak/git-hooks-example</a></p>
<p>Happy Coding 🍻</p>
        </main>
        <footer class="">
            
                        <script src="https://giscus.app/client.js" data-repo="kaylumah/hosting" data-repo-id="MDEwOlJlcG9zaXRvcnkzMzgyNzg4MzU="  data-mapping="number" data-term="146" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light_high_contrast" data-lang="en" data-loading="lazy" crossorigin="anonymous" async>
                        </script>
                        
        </footer>
    </article>
    <ul id="tiles" class="flex-none flex flex-col items-center gap-4">
        <li class="w-full laptop:w-64">
            <div class="bg-slate-50 border-2 p-6 flex flex-col items-center gap-2">
                <img class="rounded-full h-32 w-32" src="/assets/avatar_background.svg" alt="Kaylumah Hero" />
                <h2 class="text-xl font-semibold">Max Hamulyák</h2>
                <span>aka Kaylumah</span>
            </div>
        </li>
        <li class="w-full laptop:w-64">
            <div class="bg-slate-50 border-2 p-6 flex flex-col items-center gap-2">
                <h2 class="text-xl font-semibold">Sponsors</h2>
                <p>
                    Enjoy reading my content? Consider becoming a sponsor for the blog.
                    This will help keep the blog up and running! 
                </p>
                <ul class="flex flex-row items-center gap-2">
                    <li>
                        <a href="https://www.buymeacoffee.com/kaylumah" target="_blank">
                            <svg class="block h-8 w-8" role="img" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none">
                                <!-- https://simpleicons.org -->
                                <title>Buy Me A Coffee</title>
                                <path fill="#FFDD00" d="M20.216 6.415l-.132-.666c-.119-.598-.388-1.163-1.001-1.379-.197-.069-.42-.098-.57-.241-.152-.143-.196-.366-.231-.572-.065-.378-.125-.756-.192-1.133-.057-.325-.102-.69-.25-.987-.195-.4-.597-.634-.996-.788a5.723 5.723 0 00-.626-.194c-1-.263-2.05-.36-3.077-.416a25.834 25.834 0 00-3.7.062c-.915.083-1.88.184-2.75.5-.318.116-.646.256-.888.501-.297.302-.393.77-.177 1.146.154.267.415.456.692.58.36.162.737.284 1.123.366 1.075.238 2.189.331 3.287.37 1.218.05 2.437.01 3.65-.118.299-.033.598-.073.896-.119.352-.054.578-.513.474-.834-.124-.383-.457-.531-.834-.473-.466.074-.96.108-1.382.146-1.177.08-2.358.082-3.536.006a22.228 22.228 0 01-1.157-.107c-.086-.01-.18-.025-.258-.036-.243-.036-.484-.08-.724-.13-.111-.027-.111-.185 0-.212h.005c.277-.06.557-.108.838-.147h.002c.131-.009.263-.032.394-.048a25.076 25.076 0 013.426-.12c.674.019 1.347.067 2.017.144l.228.031c.267.04.533.088.798.145.392.085.895.113 1.07.542.055.137.08.288.111.431l.319 1.484a.237.237 0 01-.199.284h-.003c-.037.006-.075.01-.112.015a36.704 36.704 0 01-4.743.295 37.059 37.059 0 01-4.699-.304c-.14-.017-.293-.042-.417-.06-.326-.048-.649-.108-.973-.161-.393-.065-.768-.032-1.123.161-.29.16-.527.404-.675.701-.154.316-.199.66-.267 1-.069.34-.176.707-.135 1.056.087.753.613 1.365 1.37 1.502a39.69 39.69 0 0011.343.376.483.483 0 01.535.53l-.071.697-1.018 9.907c-.041.41-.047.832-.125 1.237-.122.637-.553 1.028-1.182 1.171-.577.131-1.165.2-1.756.205-.656.004-1.31-.025-1.966-.022-.699.004-1.556-.06-2.095-.58-.475-.458-.54-1.174-.605-1.793l-.731-7.013-.322-3.094c-.037-.351-.286-.695-.678-.678-.336.015-.718.3-.678.679l.228 2.185.949 9.112c.147 1.344 1.174 2.068 2.446 2.272.742.12 1.503.144 2.257.156.966.016 1.942.053 2.892-.122 1.408-.258 2.465-1.198 2.616-2.657.34-3.332.683-6.663 1.024-9.995l.215-2.087a.484.484 0 01.39-.426c.402-.078.787-.212 1.074-.518.455-.488.546-1.124.385-1.766zm-1.478.772c-.145.137-.363.201-.578.233-2.416.359-4.866.54-7.308.46-1.748-.06-3.477-.254-5.207-.498-.17-.024-.353-.055-.47-.18-.22-.236-.111-.71-.054-.995.052-.26.152-.609.463-.646.484-.057 1.046.148 1.526.22.577.088 1.156.159 1.737.212 2.48.226 5.002.19 7.472-.14.45-.06.899-.13 1.345-.21.399-.072.84-.206 1.08.206.166.281.188.657.162.974a.544.544 0 01-.169.364zm-6.159 3.9c-.862.37-1.84.788-3.109.788a5.884 5.884 0 01-1.569-.217l.877 9.004c.065.78.717 1.38 1.5 1.38 0 0 1.243.065 1.658.065.447 0 1.786-.065 1.786-.065.783 0 1.434-.6 1.499-1.38l.94-9.95a3.996 3.996 0 00-1.322-.238c-.826 0-1.491.284-2.26.613z"/>
                            </svg>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/sponsors/kaylumah" target="_blank">
                            <svg class="block h-8 w-8" role="img" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none">
                                <!-- https://simpleicons.org -->
                                <title>GitHub Sponsors</title>
                                <path fill="#EA4AAA" d="M17.625 1.499c-2.32 0-4.354 1.203-5.625 3.03-1.271-1.827-3.305-3.03-5.625-3.03C3.129 1.499 0 4.253 0 8.249c0 4.275 3.068 7.847 5.828 10.227a33.14 33.14 0 0 0 5.616 3.876l.028.017.008.003-.001.003c.163.085.342.126.521.125.179.001.358-.041.521-.125l-.001-.003.008-.003.028-.017a33.14 33.14 0 0 0 5.616-3.876C20.932 16.096 24 12.524 24 8.249c0-3.996-3.129-6.75-6.375-6.75zm-.919 15.275a30.766 30.766 0 0 1-4.703 3.316l-.004-.002-.004.002a30.955 30.955 0 0 1-4.703-3.316c-2.677-2.307-5.047-5.298-5.047-8.523 0-2.754 2.121-4.5 4.125-4.5 2.06 0 3.914 1.479 4.544 3.684.143.495.596.797 1.086.796.49.001.943-.302 1.085-.796.63-2.205 2.484-3.684 4.544-3.684 2.004 0 4.125 1.746 4.125 4.5 0 3.225-2.37 6.216-5.048 8.523z"/>
                            </svg>
                        </a>
                    </li>
                </ul>
            </div>
        </li>
        <li class="w-full laptop:w-64">
            
            
            
            <div class="bg-slate-50 border-2 p-6 flex flex-col items-center gap-2">
                <h2 class="text-xl font-semibold">Popular posts</h2>
                <ul class="flex flex-col gap-2">
                    
                            <li>
                                <a href="/2021/04/11/an-approach-to-writing-mocks.html">Experiment with Moq, an approach to writing mocks</a>
                            </li>
                            
                            <li>
                                <a href="/2019/09/07/using-csharp-code-your-git-hooks.html">Using C# code in your git hooks</a>
                            </li>
                            
                </ul>
            </div>

        </li>
        <li class="w-full laptop:w-64">
            
            
            
        </li>
        <li class="w-full laptop:w-64">
            <div class="bg-slate-50 border-2 p-6 flex flex-col items-center gap-2">
                <h2 class="text-xl font-semibold">Tags</h2>
                <ul id="word-cloud" class="flex justify-center flex-wrap align-center gap-2 leading-8">
                </ul>
                <script>
                var words = [];
                
                var container = document.getElementById('word-cloud');
                words.forEach(word => {
                  const li = document.createElement('li');
                  const anchor = document.createElement('a');
                  anchor.href = word.Uri;
                  anchor.title = word.Description;
                  anchor.text = `${word.DisplayName} (${word.Size})`;
                  const x = word.Size;
                  switch(true)
                  {
                    case (x < 2):
                      anchor.classList = "text-md"//; text-gray-500";
                      break;
                    case (x < 4):
                      anchor.classList = "text-lg"//; text-blue-500";
                      break;
                    case (x < 6):
                      anchor.classList = "text-xl"//; text-red-500";
                      break;
                    default:
                      anchor.classList = "text-2xl"//; text-green-500";
                      break;
                  }
                
                  li.appendChild(anchor);
                  container.appendChild(li);
                });  
                </script>
            </div>
        </li>
    </ul>
</div>

        </main>
        <footer class="bg-gray-900 p-4">
            <div class="flex flex-col text-center text-gray-100">
                <span data-testid="Footer-CopyrightNotice">© Kaylumah. All rights reserved.</span>
                <!-- <span class="text-xs">Deployed from commit <a data-testid="FooterLink-CommitId" class="hover:text-gray-400" href="https://github.com/kaylumah/hosting/commit/[COMMIT-HASH]">[SHORT-COMMIT-HASH]</a> via build <a data-testid="FooterLink-BuildId" class="hover:text-gray-400" href="https://github.com/kaylumah/hosting/actions/runs/[BUILD-ID]">BuildNumber_1</a></span> -->
            </div>
        </footer>
        <div id="cookie-banner" class="fixed inset-x-0 bottom-0 z-10 flex flex-col justify-between gap-x-8 gap-y-4 bg-white p-6 tablet:flex-row tablet:items-center laptop:px-8">
            <p class="text-sm leading-6 text-gray-900">This website uses cookies to enhance your browsing experience, analyze site traffic, and serve better user experiences. By continuing to use this site, you consent to our use of cookies. Learn more in our <a class="font-semibold text-teal-900" href="/privacy">cookie policy</a>.</p>
            <div class="mr-16 flex flex-none items-center gap-x-5">
                <button onclick="handleCookieConsentGranted()" type="button" class="rounded-md bg-gray-900 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-700">Accept all</button>
                <button onclick="handleCookieConsentDenied()" type="button" class="text-sm font-semibold leading-6 text-gray-900">Reject all</button>
            </div>
            <script>

                window.hideCookieBanner = function() {
                    let cookieBanner = document.getElementById("cookie-banner");
                    cookieBanner.classList.toggle("hidden");
                }
    
                window.handleCookieConsentGranted = function() {
                  window.setCookieConsent("granted");
                  window.setGtagConsentStatus("update", "granted");
                  window.hideCookieBanner();
                }
              
                window.handleCookieConsentDenied = function() {
                    window.setCookieConsent("denied");
                    window.setGtagConsentStatus("update", "denied");
                    window.hideCookieBanner();
                }
    
                let hideCookieBanner = window.getCookieConsent() != "unknown";
                if (hideCookieBanner)
                {
                    window.hideCookieBanner();
                }
              
            </script>
        </div>
    </div>
</body>

</html>