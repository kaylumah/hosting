<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="/assets/images/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png" />
    <link rel="manifest" href="/assets/images/site.webmanifest" />
    <link rel="mask-icon" href="/assets/images/safari-pinned-tab.svg" color="DarkGreen" />

    <link href="/compiled.css?v=[SHORT-COMMIT-HASH]" rel="stylesheet" />

    <!-- Begin Kaylumah SEO tag v[SHORT-COMMIT-HASH] -->
    
    <!-- Common Meta Tags -->
    <title>Validated Strongly Typed IOptions</title>
    <link rel="canonical" href="https://BaseUrl_1/2021/11/29/validated-strongly-typed-ioptions.html" />
    <meta name="generator" content="Kaylumah v[SHORT-COMMIT-HASH]" />
    <meta name="description" content="Find configuration errors early with data annotations validation for IOptions in .NET" />
    <meta name="copyright" content="© Kaylumah. All rights reserved." />
    <meta name="keywords" content="csharp, configuration" />
    
    <!-- OpenGraph Meta Tags -->
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en" />
    <meta property="og:site_name" content="Max Hamulyák · Kaylumah" />
    <meta property="og:title" content="Validated Strongly Typed IOptions" />
    <meta property="og:url" content="https://BaseUrl_1/2021/11/29/validated-strongly-typed-ioptions.html" />
    <meta property="og:description" content="Find configuration errors early with data annotations validation for IOptions in .NET" />
    <meta property="og:image" content="https://BaseUrl_1/assets/images/posts/20211129/validated-strongly-typed-ioptions/cover_image.png" />
    <meta property="article:author" content="Max Hamulyák" />
    <meta property="article:published_time" content="2021-11-29T19:00:00.0000000+01:00" />
    <meta property="article:modified_time" content="2021-11-29T19:00:00.0000000+01:00" />
    <meta property="article:tag" content="csharp" />
    <meta property="article:tag" content="configuration" />
    
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Validated Strongly Typed IOptions" />
    <meta name="twitter:description" content="Find configuration errors early with data annotations validation for IOptions in .NET" />
    <meta name="twitter:image" content="https://BaseUrl_1/assets/images/posts/20211129/validated-strongly-typed-ioptions/cover_image.png" />
    <meta name="twitter:site" content="@kaylumah" />
    <meta name="twitter:creator" content="@kaylumah" />
    
    <!-- Kaylumah BuildInfo Meta Tags -->
    <meta property="kaylumah:copyright" content="© Kaylumah. All rights reserved." />
    <meta property="kaylumah:commit" content="[COMMIT-HASH]" />
    <meta property="kaylumah:version" content="1.0.0.BuildNumber_1" />
    <meta property="kaylumah:buildId" content="[BUILD-ID]" />
    <meta property="kaylumah:buildNumber" content="BuildNumber_1" />
    <meta property="kaylumah:time" content="DateTimeOffset_1" />
    <meta property="kaylumah:site" content="Guid_1" />
    <meta property="kaylumah:page" content="Guid_2" />
    
    <!-- LdJson Meta Tags -->
    <script type="application/ld+json">{
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "description": "Find configuration errors early with data annotations validation for IOptions in .NET",
      "image": "https://BaseUrl_1/assets/images/posts/20211129/validated-strongly-typed-ioptions/cover_image.png",
      "mainEntityOfPage": "https://BaseUrl_1/2021/11/29/validated-strongly-typed-ioptions.html",
      "url": "https://BaseUrl_1/2021/11/29/validated-strongly-typed-ioptions.html",
      "author": {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Max Hamulyák",
        "image": "https://BaseUrl_1/assets/avatar_background.svg",
        "sameAs": [
          "https://www.linkedin.com/in/maxhamulyak",
          "https://twitter.com/kaylumah"
        ],
        "email": "max@kaylumah.nl"
      },
      "dateModified": "2021-11-29T19:00:00+01:00",
      "datePublished": "2021-11-29T19:00:00+01:00",
      "headline": "Validated Strongly Typed IOptions",
      "keywords": "csharp,configuration",
      "publisher": {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "kaylumah",
        "sameAs": "https://www.linkedin.com/company/kaylumah",
        "foundingDate": "2020-01-01",
        "logo": "https://BaseUrl_1/assets/logo.svg"
      }
    }</script>
    
    <!-- End Kaylumah SEO tag -->
    <!-- BEGIN Feed MetaData-->
    <link
      type="application/atom+xml"
      rel="alternate"
      href="https://BaseUrl_1/feed.xml"
      title="Max Hamulyák · Kaylumah RSS Feed"
    />
    <!-- END Feed MetaData -->
    <!--
                                                        
       _  __           _                       _        
      | |/ /__ _ _   _| |_   _ _ __ ___   __ _| |__     
      | ' // _` | | | | | | | | '_ ` _ \ / _` | '_ \    
      | . \ (_| | |_| | | |_| | | | | | | (_| | | | |   
      |_|\_\__,_|\__, |_|\__,_|_| |_| |_|\__,_|_| |_|   
                 |___/                                  
                                                        
     You found 🧸                                      
                                                       
    -->
    
    <script>
    
      const consoleSignatureText = '%c👨‍💻 Thank you for your visit to my little spot on the internet, be welcome! 🧸';
      const consoleSignatureStyle = `
      font-size: 16px;
      background: #4cae50;
      color: white;
      text-align: center;
      padding: 10px 15px;
      width: 100%;
      border-radius: 20px;
    `;
      console.log(consoleSignatureText, consoleSignatureStyle);
    </script>
    <script>
      window.getCookieConsent = function() {
          try {
              const consent = document.cookie.match(/cookie-consent=([^;]+)/)[1];
              return consent;
          } catch (error) {
              console.log("failed to retrieve consent", error);
              return "unknown";
          }
      };
    
      window.setCookieConsent = function(status) {
    
        if (status != "denied" && status != "granted") {
          throw new Error(`Status ${status} is not supported!`);
        }
    
        let today = new Date();
        let expiryDate = new Date(today.getFullYear() + 1, today.getMonth(), today.getDate());
        document.cookie = `cookie-consent=${status}; expires=${expiryDate}; path=/`;
      }
    
    </script>
    <script>
      // Define dataLayer and the gtag function.
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
    
      window.setGtagConsentStatus = function(mode, status) {
    
        if (mode != "update" && mode != "default") {
          throw new Error(`Mode ${mode} is not supported!`);
        }
    
        if (status != "denied" && status != "granted") {
          throw new Error(`Status ${status} is not supported!`);
        }
    
        gtag('consent', mode, {
          'ad_storage': status,
          'ad_user_data': status,
          'ad_personalization': status,
          'analytics_storage': status
        });
      }
    
      let currentStatus = window.getCookieConsent();
      let cookiesAllowed = currentStatus == "granted";
    
      if (cookiesAllowed) {
        console.log("cookies already approved");
        window.setGtagConsentStatus("default", "granted");
      } else {
        console.log("assume cookies are denied");
        window.setGtagConsentStatus("default", "denied");
      }
    </script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-168549883-1">
    </script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
    
      gtag('js', new Date());
      gtag('config', 'UA-168549883-1');
    </script>
    <link href="https://mastodon.nl/@kaylumah" rel="me">
</head>

<body class="bg-gray-100 antialiased">
    <div class="flex flex-col h-screen">
        <header class="bg-gray-900">
            <nav class="flex flex-wrap items-center justify-between p-4">
                <a data-testid="NavLink-Home" href="/" rel="home">
                    <img data-testid="NavLogo" class="h-12 w-20" height="48" width="80"
                        src="/assets/logo.svg" alt="Kaylumah" />
                </a>
                <button id="hamburger"
                    class="tablet:hidden p-2 rounded-md text-gray-100 hover:text-gray-400 hover:bg-gray-500">
                    <span class="sr-only">Open main menu</span>
                    <svg class="toggle block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                    <svg class="toggle hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <ul
                    class="toggle hidden tablet:flex w-full tablet:w-auto text-right text-bold mt-5 tablet:mt-0 border-t-2 border-gray-600 tablet:border-none">
                    
                                        <li>
                                            <a data-testid="NavLink-About" href="/about.html"
                                                class="block tablet:inline-block text-gray-100 hover:text-gray-400 px-3 py-3 border-b-2 border-gray-600 tablet:border-none">
                                                About
                                            </a>
                                        </li>
                                        
                                        <li>
                                            <a data-testid="NavLink-Blog" href="/blog.html"
                                                class="block tablet:inline-block text-gray-100 hover:text-gray-400 px-3 py-3 border-b-2 border-gray-600 tablet:border-none">
                                                Blog
                                            </a>
                                        </li>
                                        
                </ul>
            </nav>
            <script>
                document.getElementById('hamburger').onclick = function toggleMenu() {
                    const navToggle = document.getElementsByClassName('toggle');
                    for (let i = 0; i < navToggle.length; i++) {
                        navToggle.item(i).classList.toggle('hidden');
                    }
                };
            </script>
        </header>
        <main class="flex-1 p-4 text-gray-900">
            <div class="flex flex-col gap-8 laptop:flex-row">
    <article id="blogContents" class="flex-1 bg-slate-50 border-2 p-6 flex flex-col gap-8">
        <header class="prose laptop:mx-auto">
            <picture class="hidden">
                <source type="image/webp" srcset="/assets/images/posts/20211129/validated-strongly-typed-ioptions/cover_image.png.webp">
                <img loading="lazy" src="/assets/images/posts/20211129/validated-strongly-typed-ioptions/cover_image.png" alt="cover for Validated Strongly Typed IOptions" height="640" width="1280" />
            </picture>
            <h1>Validated Strongly Typed IOptions</h1>
            <div class="flex flex-row gap-4">
                <time datetime="2021-11-29">2021/11/29</time>
                <span>Max Hamulyák</span>
                <span>10 minute</span>
            </div>
            <span class="flex flex-row gap-4">
                
                                <a href="/blog.html?tag=csharp" title="for the C# programming language">C#</a>
                                
                                <a href="/blog.html?tag=configuration" title="Application configuration">Configuration</a>
                                
            </span>
        </header>
        <main class="prose laptop:mx-auto">
            <p>Almost every project will have some settings that are configured differently per environment. Chapter three of &quot;The Twelve-Factor App&quot; <a href="https://12factor.net/config" class="external">explains</a> why separating configuration from code is a good idea. In <code>.NET</code>, we use the <code>IConfigurationBuilder</code> to manage our configuration. An <code>IOptions&lt;&gt;</code> is used to make a configuration available as a strongly typed type in our applications.</p>
<p>As I understand it, the <code>configuration</code> concept in <code>.NET</code> is the combination of different configuration sources, called configuration providers, resulting in a single combined configuration. In contrast, the <code>options</code> concept provides access to <code>configuration</code> from our application code. I've attempted to illustrate it with the image below.</p>
<p><img src="https://BaseUrl_1/assets/images/posts/20211129/validated-strongly-typed-ioptions/001_configuration_sources.svg" width="1040" height="920" alt="Microsoft Extensions - IConfiguration - Different configuration sources" /></p>
<h2 id="configuration-in.net"><a href="#configuration-in.net">Configuration in .NET</a></h2>
<p>Technically the image above is an over-simplification. In reality, you use an <code>IConfigurationBuilder</code> where different providers are provided, and the configuration block in the middle is the merged build-result of the configuration builder. In fact, you get a preconfigured configuration builder every time you use the <code>ASP.NET</code> Web templates. You get a <a href="https://github.com/dotnet/runtime/blob/12a8819eee9865eb38bca6c05fdece1053102854/src/libraries/Microsoft.Extensions.Hosting/src/Host.cs#L53" class="external">default HostBuilder</a> that setups an <a href="https://github.com/dotnet/runtime/blob/12a8819eee9865eb38bca6c05fdece1053102854/src/libraries/Microsoft.Extensions.Hosting/src/HostBuilder.cs#L124" class="external">IHost</a>. This default builder also takes care of the <a href="https://github.com/dotnet/runtime/blob/12a8819eee9865eb38bca6c05fdece1053102854/src/libraries/Microsoft.Extensions.Hosting/src/HostingHostBuilderExtensions.cs#L188" class="external">default configuration</a>.</p>
<p>The default configuration adds in order</p>
<ul>
<li>appsettings.json</li>
<li>appsettings.Environment.json</li>
<li>user secrets (if the environment is development)</li>
<li>environment variables</li>
<li>command-line arguments</li>
</ul>
<p>The priority of settings is in the reverse order of adding them to the builder. Passing a setting via the <code>command line</code> will always win from a setting in the <code>appsettings.json</code> file. Fun fact, there are two configurations in <code>ASP.NET</code>. You have the <code>AppConfiguration</code> we just discussed, and you have the <code>HostConfiguration</code>. The <code>HostConfiguration</code> is used to set variables like the <code>DOTNET_ENVIRONMENT</code>, which is used to load the proper <code>appsettings.json</code> and user secrets. Via means of <code>ChainedConfiguration</code> the entire <code>HostConfiguration</code> is also available as part of <code>AppConfiguration</code>.</p>
<p>Let's look at an example. Take the following JSON configuration:</p>
<pre><code class="language-json">{
    &quot;MySample&quot;: {
        &quot;MyText&quot;: &quot;Hello World!&quot;,
        &quot;MyCollection&quot;: [
            {
                &quot;MyOtherText&quot;: &quot;Goodbye Cruel World!&quot;
            }
        ]
    }
}
</code></pre>
<p>That would result in the following two settings being present in our IConfiguration.</p>
<ul>
<li><code>MySample:MyText</code></li>
<li><code>MySample:MyCollection:0:MyOtherText</code></li>
</ul>
<p>With this bit of knowledge, you can override any setting in any provider you can imagine. Visually it would look something like the image below. You can provide sensible defaults in appsettings.json and overwrite values as needed.</p>
<p><img src="https://BaseUrl_1/assets/images/posts/20211129/validated-strongly-typed-ioptions/002_configuration_dotnet.svg" width="551" height="490" alt="Microsoft Extensions - IConfiguration - configuration builder resolve order" /></p>
<blockquote>
<p>As pointed out by the &quot;The Twelve-Factor App&quot; article linked previously, adding configuration files per environment does not scale. I typically end up with one appsettings.json for the defaults and an appsettings.Production.json that gets transformed in my CICD pipeline.</p>
</blockquote>
<p>You can <a href="https://andrewlock.net/exploring-dotnet-6-part-1-looking-inside-configurationmanager-in-dotnet-6/" class="external">read about changes to IConfiguration</a> in <code>.NET6</code> in a post from Andrew Lock. It also contains a different visual representation of configuration, which neatly displays the merging of the different levels.</p>
<h2 id="options-in.net"><a href="#options-in.net">Options in .NET</a></h2>
<p>According to the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/options?view=aspnetcore-6.0#bind-hierarchical-configuration" class="external">Microsoft Docs</a> the options pattern is the preferred way to read related configuration values. The options pattern comes in three different flavours, <code>IOptions&lt;&gt;</code>, <code>IOptionsSnapshot&lt;&gt;</code> and <code>IOptionsMonitor&lt;&gt;</code>. Probably the most used one is the default <code>IOptions</code> one, with the drawback that you cannot read configuration after your app starts. Others have taken the task upon themself to explain the differences between the interfaces, for example <a href="https://andrewlock.net/creating-singleton-named-options-with-ioptionsmonitor" class="external">Andrew Lock</a> and <a href="https://khalidabuhakmeh.com/aspnet-core-ioptions-configuration" class="external">Khalid Abuhakmeh</a>. For this post, I will keep it simple with the regular <code>IOptions</code>.</p>
<p>A typical registration of configuration would look like this:</p>
<pre><code class="language-csharp">public static partial class ServiceCollectionExtensions
{
    public static IServiceCollection AddDemo(this IServiceCollection services, IConfiguration configuration)
    {
        services.Configure&lt;DemoOptions&gt;(configuration.GetSection(DemoOptions.DefaultConfigurationSectionName));
        return services;
    }
}
</code></pre>
<blockquote>
<p>This snippet requires the <code>Microsoft Extensions Options ConfigurationExtensions</code> package to work</p>
</blockquote>
<p>Looking at our dependency injection container right after this registration, we see more than just <code>IOptions</code>. We have a total of seven registrations at this point.</p>
<pre><code class="language-output">ServiceType = 'Microsoft.Extensions.Options.IOptions`1[TOptions]' ImplementationType = 'Microsoft.Extensions.Options.UnnamedOptionsManager`1[TOptions]'
ServiceType = 'Microsoft.Extensions.Options.IOptionsSnapshot`1[TOptions]' ImplementationType = 'Microsoft.Extensions.Options.OptionsManager`1[TOptions]'
ServiceType = 'Microsoft.Extensions.Options.IOptionsMonitor`1[TOptions]' ImplementationType = 'Microsoft.Extensions.Options.OptionsMonitor`1[TOptions]'
ServiceType = 'Microsoft.Extensions.Options.IOptionsFactory`1[TOptions]' ImplementationType = 'Microsoft.Extensions.Options.OptionsFactory`1[TOptions]'
ServiceType = 'Microsoft.Extensions.Options.IOptionsMonitorCache`1[TOptions]' ImplementationType = 'Microsoft.Extensions.Options.OptionsCache`1[TOptions]'
ServiceType = 'Microsoft.Extensions.Options.IOptionsChangeTokenSource`1[Test.Unit.DemoOptions]' ImplementationType = ''
ServiceType = 'Microsoft.Extensions.Options.IConfigureOptions`1[Test.Unit.DemoOptions]' ImplementationType = ''
</code></pre>
<p>The problem with the above approach is that it assumes the configuration exists at a predefined section, which is not very flexible. An alternative approach to register <code>IOptions</code> is the use of an <code>Action&lt;&gt;</code>.</p>
<pre><code class="language-csharp">public static partial class ServiceCollectionExtensions
{
    public static IServiceCollection AddExample(this IServiceCollection services, Action&lt;ExampleOptions&gt; configureDelegate)
    {
        services.Configure(configureDelegate);
        return services;
    }
}
</code></pre>
<p>With this approach, we get a total of six DI registrations.</p>
<pre><code class="language-output">ServiceType = 'Microsoft.Extensions.Options.IOptions`1[TOptions]' ImplementationType = 'Microsoft.Extensions.Options.UnnamedOptionsManager`1[TOptions]'
ServiceType = 'Microsoft.Extensions.Options.IOptionsSnapshot`1[TOptions]' ImplementationType = 'Microsoft.Extensions.Options.OptionsManager`1[TOptions]'
ServiceType = 'Microsoft.Extensions.Options.IOptionsMonitor`1[TOptions]' ImplementationType = 'Microsoft.Extensions.Options.OptionsMonitor`1[TOptions]'
ServiceType = 'Microsoft.Extensions.Options.IOptionsFactory`1[TOptions]' ImplementationType = 'Microsoft.Extensions.Options.OptionsFactory`1[TOptions]'
ServiceType = 'Microsoft.Extensions.Options.IOptionsMonitorCache`1[TOptions]' ImplementationType = 'Microsoft.Extensions.Options.OptionsCache`1[TOptions]'
ServiceType = 'Microsoft.Extensions.Options.IConfigureOptions`1[Test.Unit.ExampleOptions]' ImplementationType = ''
</code></pre>
<p>The only difference is that we do not get the <code>IOptionsChangeTokenSource</code>. To be most flexible, you can combine both techniques like this.</p>
<pre><code class="language-csharp">public static partial class ServiceCollectionExtensions
{
    public static IServiceCollection AddExample(this IServiceCollection services, IConfiguration config)
    {
        services.AddExample(options =&gt; config.GetSection(ExampleOptions.DefaultConfigurationSectionName).Bind(options));
        return services;
    }

    public static IServiceCollection AddExample(this IServiceCollection services, Action&lt;ExampleOptions&gt; configureDelegate)
    {
        services.Configure(configureDelegate);
        return services;
    }
}
</code></pre>
<h2 id="validated-options"><a href="#validated-options">Validated Options</a></h2>
<p>Now that we covered the basics, I can move on to the focal point of this blog post. As you can imagine overlaying the different configuration sources does not guarantee a valid result from the point of view of your application. Worse, since the number of configuration sources can differ between environments, you can potentially have configuration issues very late in your CICD pipeline. For example, if you use Azure Key Vault as a configuration provider, settings might be changed by anyone with access to the vault.</p>
<p>In my article <a href="https://BaseUrl_1/2021/05/23/generate-csharp-client-for-openapi.html">Generate C# client for OpenAPI</a>, I used HttpClient to call a generated OpenAPI service. HTTP is the perfect example for validating configuration. In our API example, we will likely have different base URLs per environment. If we represent an URL as a string in configuration, it is feasible to enter &quot;not-an-url&quot; as its value, which causes your application to crash and burn.</p>
<p>As I see it, there are two distinct ways configuration can fail.</p>
<h3 id="missing-configuration-sections"><a href="#missing-configuration-sections">Missing Configuration Sections</a></h3>
<p>The first variant is binding configuration at a section that does not exist. That is because <code>configuration.GetSection</code> does not throw but <a href="https://docs.microsoft.com/en-us/dotnet/api/system.configuration.configuration.getsection?view=dotnet-plat-ext-6.0" class="external">returns null</a> for a section that does not exist. Oddly enough, when configuration fails to bind, you still get an <code>IOptions&lt;TOptions&gt;</code> but with null values.</p>
<p>When specifying a section by name, I expect that section to exist. Therefore I want my application to not boot with missing configuration sections. The following extension method takes care of that.</p>
<pre><code class="language-cs">public static IConfigurationSection GetExistingSectionOrThrow(this IConfiguration configuration, string key)
{
    var configurationSection = configuration.GetSection(key);

    if (!configurationSection.Exists())
    {
        throw configuration switch
        {
            IConfigurationRoot configurationIsRoot =&gt; new ArgumentException($&quot;Section with key '{key}' does not exist. Existing values are: {configurationIsRoot.GetDebugView()}&quot;, nameof(key)),
            IConfigurationSection configurationIsSection =&gt; new ArgumentException($&quot;Section with key '{key}' does not exist at '{configurationIsSection.Path}'. Expected configuration path is '{configurationSection.Path}'&quot;, nameof(key)),
            _ =&gt; new ArgumentException($&quot;Failed to find configuration at '{configurationSection.Path}'&quot;, nameof(key))
        };
    }

    return configurationSection;
}
</code></pre>
<blockquote>
<p><strong>caution</strong>: configurationIsRoot.GetDebugView() prints all configuration settings and their value, if you have secrets you should add log masking to prevent them from being logged.</p>
</blockquote>
<h3 id="dataannotations-validation"><a href="#dataannotations-validation">DataAnnotations Validation</a></h3>
<p>The second variant is the most likely to occur. That is, settings are present but not valid in the context of the application. I recently browsed the Microsoft Docs after (again) losing time chasing configuration issues when I came across <code>IValidateOptions</code>. I also rediscovered <code>ValidateDataAnnotations</code> on the <code>IOptionsBuilder</code>, which I previously dismissed since it was a different API (<code>AddOptions&lt;&gt;</code>) than the <code>Configure&lt;&gt;</code> APIs. With Resharper by my side, I checked the implementation and discovered that it uses <code>DataAnnotationValidateOptions</code> a class that is a <code>IValidateOptions</code>.</p>
<p>When consuming an IOptions, there are three hooks we can use. We have <code>IConfigureOptions</code>, <code>IPostConfigureOptions</code> and <code>IValidateOptions</code>. If you head back up to where I printed the dependency injection container, you see that every time you use <code>Configure&lt;&gt;</code>, you get an <code>IConfigureOptions</code>. I illustrated this process below, IOptions makes use of an OptionsFactory. This factory goes through all registered &quot;option services&quot;.</p>
<p><img src="https://BaseUrl_1/assets/images/posts/20211129/validated-strongly-typed-ioptions/003_ioptions.svg" width="837" height="1674" alt="Microsoft Extensions - IConfiguration - options factory" /></p>
<p>You can add any number of implementations of these three interfaces. Implementations of the same interface execute in the order in which you define them. If you register an <code>IPostConfigureOptions</code> or <code>IValidateOptions</code> before the normal <code>IConfigureOptions</code>, it won't run before it. The factory runs through 0 or more <code>IConfigureOptions</code>, 0 or more <code>IPostConfigureOptions</code> and finally 0 or more <code>IValidateOptions</code> and always in that order.</p>
<p>To demonstrate how this works, consider the following example:</p>
<pre><code class="language-csharp">public class ConfigureLibraryExampleServiceOptions : IConfigureOptions&lt;LibraryExampleServiceOptions&gt;, IPostConfigureOptions&lt;LibraryExampleServiceOptions&gt;, IValidateOptions&lt;LibraryExampleServiceOptions&gt;
{
    private readonly ILogger _logger;

    public ConfigureLibraryExampleServiceOptions(ILogger&lt;ConfigureLibraryExampleServiceOptions&gt; logger)
    {
        _logger = logger;
    }
    
    public void Configure(LibraryExampleServiceOptions options)
    {
        _logger.LogInformation(&quot;ConfigureExampleServiceOptions Configure&quot;);
    }

    public void PostConfigure(string name, LibraryExampleServiceOptions options)
    {
        _logger.LogInformation(&quot;ConfigureExampleServiceOptions PostConfigure&quot;);
    }

    public ValidateOptionsResult Validate(string name, LibraryExampleServiceOptions options)
    {
        _logger.LogInformation(&quot;ConfigureExampleServiceOptions ValidateOptionsResult&quot;);
        return ValidateOptionsResult.Skip;
    }
}
</code></pre>
<p>You might assume that this validation triggers the moment we resolve an IOptions from the DI container. Unfortunately, this is not the case; it only triggers when using the <code>.Value</code> property.</p>
<pre><code class="language-csharp">var configuration = new ConfigurationBuilder()
    .AddInMemoryCollection(new Dictionary&lt;string, string&gt;() {
        [string.Join(&quot;:&quot;, LibraryExampleServiceOptions.DefaultConfigurationSectionName, nameof(LibraryExampleServiceOptions.BaseUrl))] = &quot;http://example.com&quot;
    })
    .Build();
var serviceProvider = new ServiceCollection()
    .AddLogging(builder =&gt; builder.AddConsole())
    .AddExampleLibrary(configuration)
    .BuildServiceProvider();

var logger = serviceProvider.GetRequiredService&lt;ILogger&lt;Program&gt;&gt;();
logger.LogInformation(&quot;Before retrieving IOptions&quot;);
var options = serviceProvider.GetRequiredService&lt;IOptions&lt;LibraryExampleServiceOptions&gt;&gt;();
logger.LogInformation(&quot;After retrieving IOptions; before IOptions.Value&quot;);
var optionsValue = options.Value;
logger.LogInformation(&quot;After IOptions.Value&quot;);

Console.ReadLine();
</code></pre>
<p>Which outputs:</p>
<pre><code class="language-output">info: Program[0]
      Before retrieving IOptions
info: Program[0]
      After retrieving IOptions; before IOptions.Value
info: Kaylumah.ValidatedStronglyTypedIOptions.Library.ConfigureLibraryExampleServiceOptions[0]
      ConfigureExampleServiceOptions Configure
info: Kaylumah.ValidatedStronglyTypedIOptions.Library.ConfigureLibraryExampleServiceOptions[0]
      ConfigureExampleServiceOptions PostConfigure
info: Kaylumah.ValidatedStronglyTypedIOptions.Library.ConfigureLibraryExampleServiceOptions[0]
      ConfigureExampleServiceOptions ValidateOptionsResult
info: Program[0]
      After IOptions.Value
</code></pre>
<p>Circling back to validation, I've created an extension method that registers <code>DataAnnotationValidateOptions </code>for us. One thing to note is that <code>IValidateOptions</code> is a named option, whereas the normal <code>IOptions</code> is an unnamed option. Microsoft solved this by providing a &quot;DefaultName&quot; for an options object which is an empty string.</p>
<pre><code class="language-csharp">public static partial class ServiceCollectionExtensions
{
    public static IServiceCollection ConfigureWithValidation&lt;TOptions&gt;(this IServiceCollection services, IConfiguration config) where TOptions : class
        =&gt; services.ConfigureWithValidation&lt;TOptions&gt;(Options.Options.DefaultName, config);
    
    public static IServiceCollection ConfigureWithValidation&lt;TOptions&gt;(this IServiceCollection services, string name, IConfiguration config) where TOptions : class
    {
        _ = config ?? throw new ArgumentNullException(nameof(config));
        services.Configure&lt;TOptions&gt;(name, config);
        services.AddDataAnnotationValidatedOptions&lt;TOptions&gt;(name);
        return services;
    }

    public static IServiceCollection ConfigureWithValidation&lt;TOptions&gt;(this IServiceCollection services, Action&lt;TOptions&gt; configureOptions) where TOptions : class
        =&gt; services.ConfigureWithValidation&lt;TOptions&gt;(Options.Options.DefaultName, configureOptions);

    public static IServiceCollection ConfigureWithValidation&lt;TOptions&gt;(this IServiceCollection services, string name, Action&lt;TOptions&gt; configureOptions) where TOptions : class
    {
        services.Configure(name, configureOptions);
        services.AddDataAnnotationValidatedOptions&lt;TOptions&gt;(name);
        return services;
    }

    private static IServiceCollection AddDataAnnotationValidatedOptions&lt;TOptions&gt;(this IServiceCollection services, string name) where TOptions : class
    {
        services.TryAddEnumerable(ServiceDescriptor.Singleton&lt;IValidateOptions&lt;TOptions&gt;&gt;(new DataAnnotationValidateOptions&lt;TOptions&gt;(name)));
        return services;
    }
}
</code></pre>
<p>If we put it to the test, our settings object could look like this. In this case, we use the <code>Required</code> and <code>Url</code> attributes. You can use <a href="https://docs.microsoft.com/en-us/dotnet/api/system.componentmodel.dataannotations?view=net-6.0" class="external">any of the attributes</a> provided by default, or create your custom attributes.</p>
<pre><code class="language-csharp">public class LibraryExampleServiceOptions
{
    public const string DefaultConfigurationSectionName = nameof(LibraryExampleServiceOptions);

    [Required, Url]
    public string? BaseUrl { get;set; }
}
</code></pre>
<blockquote>
<p>Consider nullability and default values of properties when defining them. In the spirit of the example, you might have a retry-count if it has the value 0; is that because you specified it or forgot to define it? That's why I always define properties as <code>[Required]</code> and <code>Nullable</code>.</p>
</blockquote>
<pre><code class="language-output">info: Program[0]
      Before retrieving IOptions
info: Program[0]
      After retrieving IOptions; before IOptions.Value
info: Kaylumah.ValidatedStronglyTypedIOptions.Library.ConfigureLibraryExampleServiceOptions[0]
      ConfigureExampleServiceOptions Configure
info: Kaylumah.ValidatedStronglyTypedIOptions.Library.ConfigureLibraryExampleServiceOptions[0]
      ConfigureExampleServiceOptions PostConfigure
info: Kaylumah.ValidatedStronglyTypedIOptions.Library.ConfigureLibraryExampleServiceOptions[0]
      ConfigureExampleServiceOptions ValidateOptionsResult
Unhandled exception. Microsoft.Extensions.Options.OptionsValidationException: DataAnnotation validation failed for 'LibraryExampleServiceOptions' members: 'BaseUrl' with the error: 'The BaseUrl field is not a valid fully-qualified http, https, or ftp URL.'.
   at Microsoft.Extensions.Options.OptionsFactory`1.Create(String name)
   at Microsoft.Extensions.Options.UnnamedOptionsManager`1.get_Value()
   at Program.&lt;Main&gt;$(String[] args) 
</code></pre>
<p>I think that is pretty neat. But I am not a big fan of the formatting. I remember the last time I used the <code>Web API</code> template, which resulted in a nicely formatted error. I had to dig in the ASPNET code, and it's the <a href="https://github.com/dotnet/aspnetcore/blob/a450cb69b5e4549f5515cdb057a68771f56cefd7/src/Mvc/Mvc.Core/src/Infrastructure/ModelStateInvalidFilter.cs#L80" class="external">ModelStateInvalidFilter</a> that transforms <a href="https://github.com/dotnet/aspnetcore/blob/d9660d157627af710b71c636fa8cb139616cadba/src/Mvc/Mvc.Abstractions/src/ModelBinding/ModelStateDictionary.cs#L147" class="external">ModelStateDictionary.cs</a> into a ValidationProblemDetails. I've added an example of this to the source repo, with the output shown below.</p>
<pre><code class="language-json">{
    &quot;type&quot;: &quot;https://tools.ietf.org/html/rfc7231#section-6.5.1&quot;,
    &quot;title&quot;: &quot;One or more validation errors occurred.&quot;,
    &quot;status&quot;: 400,
    &quot;traceId&quot;: &quot;00-50f5816f844377e66f37688f297dfd29-ab771434a82ee290-00&quot;,
    &quot;errors&quot;: {
        &quot;Name&quot;: [&quot;The Name field is required.&quot;],
        &quot;EmailAddresses[0].Label&quot;: [&quot;The Label field is required.&quot;],
        &quot;EmailAddresses[0].Address&quot;: [&quot;The Address field is required.&quot;]
    }
}
</code></pre>
<p>In the example above, I added validation on both the parent and the child DTO. It appears, however, that doing the same with DataAnnotations does not work. To enable the same behaviour for DataAnnotations, we can create custom <code>ValidationAttributes</code>. We begin with defining a special <code>ValidationResult</code> that is a composite of multiple ValidationResults.</p>
<pre><code class="language-csharp">public class CompositeValidationResult : System.ComponentModel.DataAnnotations.ValidationResult
{
    private readonly List&lt;System.ComponentModel.DataAnnotations.ValidationResult&gt; results = new();

    public IEnumerable&lt;System.ComponentModel.DataAnnotations.ValidationResult&gt; Results =&gt; results;

    public CompositeValidationResult(string? errorMessage) : base(errorMessage)
    {
    }

    public CompositeValidationResult(string errorMessage, IEnumerable&lt;string&gt;? memberNames) : base(errorMessage, memberNames)
    {
    }

    protected CompositeValidationResult(System.ComponentModel.DataAnnotations.ValidationResult validationResult) : base(validationResult)
    {
    }

    public void AddResult(System.ComponentModel.DataAnnotations.ValidationResult validationResult)
    {
        results.Add(validationResult);
    }
}
</code></pre>
<p>Next we create a custom <code>ValidationAttribute</code> for objects.</p>
<pre><code class="language-csharp">[AttributeUsage(AttributeTargets.Property | AttributeTargets.Parameter)]
public sealed class ValidateObjectAttribute : ValidationAttribute
{
    protected override System.ComponentModel.DataAnnotations.ValidationResult IsValid(object? value, ValidationContext validationContext)
    {
        if (value != null &amp;&amp; validationContext != null)
        {
            var results = new List&lt;System.ComponentModel.DataAnnotations.ValidationResult&gt;();
            var context = new ValidationContext(value, null, null);

            System.ComponentModel.DataAnnotations.Validator.TryValidateObject(value, context, results, true);

            if (results.Count != 0)
            {
                var compositeValidationResult = new CompositeValidationResult($&quot;Validation for {validationContext.DisplayName} failed.&quot;, new[] { validationContext.MemberName });
                results.ForEach(compositeValidationResult.AddResult);

                return compositeValidationResult;
            }
        }

        return System.ComponentModel.DataAnnotations.ValidationResult.Success;
    }
}
</code></pre>
<p>And finally, we need a <code>ValidationAttribute</code> for collections.</p>
<pre><code class="language-csharp">[AttributeUsage(AttributeTargets.Property | AttributeTargets.Parameter)]
public sealed class ValidateCollectionAttribute : ValidationAttribute
{
    protected override System.ComponentModel.DataAnnotations.ValidationResult IsValid(object? value, ValidationContext validationContext)
    {
        CompositeValidationResult? collectionCompositeValidationResult = null;

        if (value is IEnumerable collection &amp;&amp; validationContext != null)
        {
            var index = 0;
            foreach (var obj in collection)
            {
                var results = new List&lt;System.ComponentModel.DataAnnotations.ValidationResult&gt;();
                var context = new ValidationContext(obj, null, null);

                System.ComponentModel.DataAnnotations.Validator.TryValidateObject(obj, context, results, true);

                if (results.Count != 0)
                {
                    var compositeValidationResult = new CompositeValidationResult($&quot;Validation for {validationContext.MemberName}[{index}] failed.&quot;, new[] { $&quot;{validationContext.MemberName}[{index}]&quot; });
                    results.ForEach(compositeValidationResult.AddResult);

                    if (collectionCompositeValidationResult == null)
                    {
                        collectionCompositeValidationResult = new CompositeValidationResult($&quot;Validation for {validationContext.MemberName} failed.&quot;, new[] { validationContext.MemberName });
                    }

                    collectionCompositeValidationResult.AddResult(compositeValidationResult);
                }

                index++;
            }

            if (collectionCompositeValidationResult != null)
            {
                return collectionCompositeValidationResult;
            }
        }

        return System.ComponentModel.DataAnnotations.ValidationResult.Success;
    }
}
</code></pre>
<p>Our validation would already trigger with just these attributes. But we are also interested in handling our CompositeValidationResult and pretty-printing it.</p>
<pre><code class="language-csharp">public static class Validator
{
    public static ValidationResult[] ValidateReturnValue(object objectToValidate)
    {
        var validationResults = new List&lt;System.ComponentModel.DataAnnotations.ValidationResult&gt;();

        if (objectToValidate == null)
        {
            validationResults.Add(new System.ComponentModel.DataAnnotations.ValidationResult(&quot;Return value is required.&quot;));
        }
        else
        {
            var validationContext = new ValidationContext(objectToValidate);

            System.ComponentModel.DataAnnotations.Validator.TryValidateObject(objectToValidate, validationContext, validationResults, true);

            if (validationResults.Count != 0)
            {
                var compositeValidationResult = new CompositeValidationResult($&quot;Validation for {validationContext.DisplayName} failed.&quot;, new[] { validationContext.MemberName });
                validationResults.ForEach(compositeValidationResult.AddResult);
            }
        }

        var structuredValidationResults = StructureValidationResults(validationResults);
        return structuredValidationResults;
    }

    private static ValidationResult[] StructureValidationResults(IEnumerable&lt;System.ComponentModel.DataAnnotations.ValidationResult&gt; validationResults)
    {
        var structuredValidationResults = new List&lt;ValidationResult&gt;();
        foreach (var validationResult in validationResults)
        {
            var structuredValidationResult = new ValidationResult
            {
                ErrorMessage = validationResult.ErrorMessage,
                MemberNames = validationResult.MemberNames.ToArray()
            };

            if (validationResult is CompositeValidationResult compositeValidationResult)
            {
                structuredValidationResult.ValidationResults = StructureValidationResults(compositeValidationResult.Results);
            }

            structuredValidationResults.Add(structuredValidationResult);
        }

        return structuredValidationResults.ToArray();
    }
}
</code></pre>
<p>You can then use it in an <code>IValidateOptions</code> like this</p>
<pre><code class="language-csharp">internal class CustomValidate : IValidateOptions&lt;NestedParent&gt;
{
    public ValidateOptionsResult Validate(string name, NestedParent options)
    {
        var validationResults = Kaylumah.ValidatedStronglyTypedIOptions.Utilities.Validation.Validator.ValidateReturnValue(options);
        if (validationResults.Any())
        {
            var builder = new StringBuilder();
            foreach (var result in validationResults)
            {
                var pretty = PrettyPrint(result, string.Empty, true);
                builder.Append(pretty);
            }
            return ValidateOptionsResult.Fail(builder.ToString());
        }

        return ValidateOptionsResult.Success;
    }

    private string PrettyPrint(Kaylumah.ValidatedStronglyTypedIOptions.Utilities.Validation.ValidationResult root, string indent, bool last)
    {
        // Based on https://stackoverflow.com/a/1649223
        var sb = new StringBuilder();
        sb.Append(indent);
        if (last)
        {
            sb.Append(&quot;|-&quot;);
            indent += &quot;  &quot;;
        }
        else
        {
            sb.Append(&quot;|-&quot;);
            indent += &quot;| &quot;;
        }

        sb.AppendLine(root.ToString());

        if (root.ValidationResults != null)
        {
            for (var i = 0; i &lt; root.ValidationResults.Length; i++)
            {
                var child = root.ValidationResults[i];
                var pretty = PrettyPrint(child, indent, i == root.ValidationResults.Length - 1);
                sb.Append(pretty);
            }
        }

        return sb.ToString();
    }
}
</code></pre>
<p>Which prints</p>
<pre><code class="language-output">Microsoft.Extensions.Options.OptionsValidationException : |-Children =&gt; Validation for Children failed.
  |-Children[0] =&gt; Validation for Children[0] failed.
    |-Name =&gt; The Name field is required.

    Stack Trace:
       at Microsoft.Extensions.Options.OptionsFactory`1.Create(String name)
   at Microsoft.Extensions.Options.UnnamedOptionsManager`1.get_Value()
</code></pre>
<p>That looks more like it. One thing this approach, unfortunately, cannot solve is that errors occur at runtime. Wherewith <code>IConfiguration</code>, we could get the error at startup; we don't have the same luxury with <code>IOptions</code> since, as demonstrated, <code>Value</code> triggers at runtime. It is, however, a step in the right direction.</p>
<blockquote>
<p><strong>Note</strong>: since IOptions&lt;&gt; is an unbound generic you cannot retrieve all instances of it from the DI container to trigger this behaviour at startup</p>
</blockquote>
<h2 id="bonus-strongly-typed-options"><a href="#bonus-strongly-typed-options">Bonus: Strongly typed options</a></h2>
<p>I never liked using <code>IOptions&lt;&gt;</code> all over the place. I've found it especially bothersome in unit tests. I would either need <code>Options.Create</code> or create an <code>IOptions</code> Moq. If you don't rely on reloading configuration (remember <code>IOptions</code> is a Singleton), you can register a typed instance, which I find pretty neat.</p>
<pre><code class="language-csharp">var serviceProvider = new ServiceCollection()
            .Configure&lt;StronglyTypedOptions&gt;(builder =&gt; {
                builder.Name = &quot;TestStronglyTypedOptions&quot;;
            })
            .AddSingleton(sp =&gt; sp.GetRequiredService&lt;IOptions&lt;StronglyTypedOptions&gt;&gt;().Value)
            .BuildServiceProvider();
var options = serviceProvider.GetRequiredService&lt;IOptions&lt;StronglyTypedOptions&gt;&gt;().Value;
var typedOptions = serviceProvider.GetRequiredService&lt;StronglyTypedOptions&gt;();
typedOptions.Name.Should().Be(options.Name);
</code></pre>
<h2 id="closing-thoughts"><a href="#closing-thoughts">Closing Thoughts</a></h2>
<p>Using the options and configuration patterns described in this article makes it a lot less likely to run into configuration errors, or at the very least, it makes it easier to troubleshoot configuration mistakes.</p>
<p>As always, if you have any questions, feel free to reach out. Do you have suggestions or alternatives? I would love to hear about them.</p>
<p>The corresponding source code for this article is on <a href="https://github.com/kaylumah/ValidatedStronglyTypedIOptions" class="external">GitHub</a>.</p>
<p>See you next time, stay healthy and happy coding to all 🧸!</p>
<h2 id="resources"><a href="#resources">Resources</a></h2>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/core/extensions/configuration" class="external">Configuration in .NET</a></li>
<li><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-6.0" class="external">Configuration in ASP.NET Core</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/core/extensions/options" class="external">Options pattern in .NET</a></li>
<li><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/options?view=aspnetcore-6.0" class="external">Options pattern in ASP.NET Core</a></li>
</ul>
        </main>
        <footer class="">
            
                        <!-- https://giscus.app -->
                        <!-- https://github.com/giscus/giscus/blob/main/ADVANCED-USAGE.md -->
                        <script src="https://giscus.app/client.js"
                            data-repo="kaylumah/hosting"
                            data-repo-id="MDEwOlJlcG9zaXRvcnkzMzgyNzg4MzU="
                            data-mapping="number"
                            data-term="140"
                            data-reactions-enabled="1"
                            data-emit-metadata="0"
                            data-input-position="top"
                            data-theme="light_high_contrast"
                            data-lang="en"
                            data-loading="lazy"
                            crossorigin="anonymous"
                            async>
                        </script>
                        
        </footer>
    </article>
    <ul id="tiles" class="flex-none flex flex-col items-center gap-4">
        <li class="w-full laptop:w-64">
            <div class="bg-slate-50 border-2 p-6 flex flex-col items-center gap-2">
                <img class="rounded-full h-32 w-32" src="/assets/avatar_background.svg" alt="Kaylumah Hero" />
                <h2 class="text-xl font-semibold">Max Hamulyák</h2>
                <span>aka Kaylumah</span>
            </div>
        </li>
        <li class="w-full laptop:w-64">
            <div class="bg-slate-50 border-2 p-6 flex flex-col items-center gap-2">
                <h2 class="text-xl font-semibold">Sponsors</h2>
                <p>
                    Enjoy reading my content? Consider becoming a sponsor for the blog.
                    This will help keep the blog up and running! 
                </p>
                <ul class="flex flex-row items-center gap-2">
                    <li>
                        <a href="https://www.buymeacoffee.com/kaylumah" target="_blank">
                            <svg class="block h-8 w-8" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none">
                                <!-- https://simpleicons.org -->
                                <title>Buy Me A Coffee</title>
                                <path fill="#FFDD00" d="M20.216 6.415l-.132-.666c-.119-.598-.388-1.163-1.001-1.379-.197-.069-.42-.098-.57-.241-.152-.143-.196-.366-.231-.572-.065-.378-.125-.756-.192-1.133-.057-.325-.102-.69-.25-.987-.195-.4-.597-.634-.996-.788a5.723 5.723 0 00-.626-.194c-1-.263-2.05-.36-3.077-.416a25.834 25.834 0 00-3.7.062c-.915.083-1.88.184-2.75.5-.318.116-.646.256-.888.501-.297.302-.393.77-.177 1.146.154.267.415.456.692.58.36.162.737.284 1.123.366 1.075.238 2.189.331 3.287.37 1.218.05 2.437.01 3.65-.118.299-.033.598-.073.896-.119.352-.054.578-.513.474-.834-.124-.383-.457-.531-.834-.473-.466.074-.96.108-1.382.146-1.177.08-2.358.082-3.536.006a22.228 22.228 0 01-1.157-.107c-.086-.01-.18-.025-.258-.036-.243-.036-.484-.08-.724-.13-.111-.027-.111-.185 0-.212h.005c.277-.06.557-.108.838-.147h.002c.131-.009.263-.032.394-.048a25.076 25.076 0 013.426-.12c.674.019 1.347.067 2.017.144l.228.031c.267.04.533.088.798.145.392.085.895.113 1.07.542.055.137.08.288.111.431l.319 1.484a.237.237 0 01-.199.284h-.003c-.037.006-.075.01-.112.015a36.704 36.704 0 01-4.743.295 37.059 37.059 0 01-4.699-.304c-.14-.017-.293-.042-.417-.06-.326-.048-.649-.108-.973-.161-.393-.065-.768-.032-1.123.161-.29.16-.527.404-.675.701-.154.316-.199.66-.267 1-.069.34-.176.707-.135 1.056.087.753.613 1.365 1.37 1.502a39.69 39.69 0 0011.343.376.483.483 0 01.535.53l-.071.697-1.018 9.907c-.041.41-.047.832-.125 1.237-.122.637-.553 1.028-1.182 1.171-.577.131-1.165.2-1.756.205-.656.004-1.31-.025-1.966-.022-.699.004-1.556-.06-2.095-.58-.475-.458-.54-1.174-.605-1.793l-.731-7.013-.322-3.094c-.037-.351-.286-.695-.678-.678-.336.015-.718.3-.678.679l.228 2.185.949 9.112c.147 1.344 1.174 2.068 2.446 2.272.742.12 1.503.144 2.257.156.966.016 1.942.053 2.892-.122 1.408-.258 2.465-1.198 2.616-2.657.34-3.332.683-6.663 1.024-9.995l.215-2.087a.484.484 0 01.39-.426c.402-.078.787-.212 1.074-.518.455-.488.546-1.124.385-1.766zm-1.478.772c-.145.137-.363.201-.578.233-2.416.359-4.866.54-7.308.46-1.748-.06-3.477-.254-5.207-.498-.17-.024-.353-.055-.47-.18-.22-.236-.111-.71-.054-.995.052-.26.152-.609.463-.646.484-.057 1.046.148 1.526.22.577.088 1.156.159 1.737.212 2.48.226 5.002.19 7.472-.14.45-.06.899-.13 1.345-.21.399-.072.84-.206 1.08.206.166.281.188.657.162.974a.544.544 0 01-.169.364zm-6.159 3.9c-.862.37-1.84.788-3.109.788a5.884 5.884 0 01-1.569-.217l.877 9.004c.065.78.717 1.38 1.5 1.38 0 0 1.243.065 1.658.065.447 0 1.786-.065 1.786-.065.783 0 1.434-.6 1.499-1.38l.94-9.95a3.996 3.996 0 00-1.322-.238c-.826 0-1.491.284-2.26.613z"/>
                            </svg>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/sponsors/kaylumah" target="_blank">
                            <svg class="block h-8 w-8" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none">
                                <!-- https://simpleicons.org -->
                                <title>GitHub Sponsors</title>
                                <path fill="#EA4AAA" d="M17.625 1.499c-2.32 0-4.354 1.203-5.625 3.03-1.271-1.827-3.305-3.03-5.625-3.03C3.129 1.499 0 4.253 0 8.249c0 4.275 3.068 7.847 5.828 10.227a33.14 33.14 0 0 0 5.616 3.876l.028.017.008.003-.001.003c.163.085.342.126.521.125.179.001.358-.041.521-.125l-.001-.003.008-.003.028-.017a33.14 33.14 0 0 0 5.616-3.876C20.932 16.096 24 12.524 24 8.249c0-3.996-3.129-6.75-6.375-6.75zm-.919 15.275a30.766 30.766 0 0 1-4.703 3.316l-.004-.002-.004.002a30.955 30.955 0 0 1-4.703-3.316c-2.677-2.307-5.047-5.298-5.047-8.523 0-2.754 2.121-4.5 4.125-4.5 2.06 0 3.914 1.479 4.544 3.684.143.495.596.797 1.086.796.49.001.943-.302 1.085-.796.63-2.205 2.484-3.684 4.544-3.684 2.004 0 4.125 1.746 4.125 4.5 0 3.225-2.37 6.216-5.048 8.523z"/>
                            </svg>
                        </a>
                    </li>
                </ul>
            </div>
        </li>
        <li class="w-full laptop:w-64">
            
            
            
            <div class="bg-slate-50 border-2 p-6 flex flex-col items-center gap-2">
                <h2 class="text-xl font-semibold">Popular posts</h2>
                <ul class="flex flex-col gap-2">
                    
                            <li>
                                <a href="/2021/04/11/an-approach-to-writing-mocks.html">Experiment with Moq, an approach to writing mocks</a>
                            </li>
                            
                            <li>
                                <a href="/2019/09/07/using-csharp-code-your-git-hooks.html">Using C# code in your git hooks</a>
                            </li>
                            
                </ul>
            </div>

        </li>
        <li class="w-full laptop:w-64">
            
            
            
        </li>
        <li class="w-full laptop:w-64">
            <div class="bg-slate-50 border-2 p-6 flex flex-col items-center gap-2">
                <h2 class="text-xl font-semibold">Tags</h2>
                <ul id="word-cloud" class="flex justify-center flex-wrap align-center gap-2 leading-8">
                </ul>
                <script>
                var words = [];
                
                var container = document.getElementById('word-cloud');
                words.forEach(word => {
                  const li = document.createElement('li');
                  const anchor = document.createElement('a');
                  anchor.href = "/blog.html?tag=" + word.Id;
                  anchor.text = `${word.DisplayName} (${word.Size})`;
                  const x = word.Size;
                  switch(true)
                  {
                    case (x < 2):
                      anchor.classList = "text-md"//; text-gray-500";
                      break;
                    case (x < 4):
                      anchor.classList = "text-lg"//; text-blue-500";
                      break;
                    case (x < 6):
                      anchor.classList = "text-xl"//; text-red-500";
                      break;
                    default:
                      anchor.classList = "text-2xl"//; text-green-500";
                      break;
                  }
                
                  li.appendChild(anchor);
                  container.appendChild(li);
                });  
                </script>
            </div>
        </li>
    </ul>
</div>

        </main>
        <footer class="bg-gray-900 p-4">
            <div class="flex flex-col text-center text-gray-100">
                <span data-testid="Footer-CopyrightNotice">© Kaylumah. All rights reserved.</span>
                <!-- <span class="text-xs">Deployed from commit <a data-testid="FooterLink-CommitId" class="hover:text-gray-400" href="https://github.com/kaylumah/hosting/commit/[COMMIT-HASH]">[SHORT-COMMIT-HASH]</a> via build <a data-testid="FooterLink-BuildId" class="hover:text-gray-400" href="https://github.com/kaylumah/hosting/actions/runs/[BUILD-ID]">BuildNumber_1</a></span> -->
            </div>
        </footer>
        <div id="cookie-banner" class="fixed inset-x-0 bottom-0 z-10 flex flex-col justify-between gap-x-8 gap-y-4 bg-white p-6 tablet:flex-row tablet:items-center laptop:px-8">
            <p class="text-sm leading-6 text-gray-900">This website uses cookies to enhance your browsing experience, analyze site traffic, and serve better user experiences. By continuing to use this site, you consent to our use of cookies. Learn more in our <a class="font-semibold text-teal-900" href="/privacy">cookie policy</a>.</p>
            <div class="mr-16 flex flex-none items-center gap-x-5">
                <button onclick="handleCookieConsentGranted()" type="button" class="rounded-md bg-gray-900 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-700">Accept all</button>
                <button onclick="handleCookieConsentDenied()" type="button" class="text-sm font-semibold leading-6 text-gray-900">Reject all</button>
            </div>
            <script>

                window.hideCookieBanner = function() {
                    let cookieBanner = document.getElementById("cookie-banner");
                    cookieBanner.classList.toggle("hidden");
                }
    
                window.handleCookieConsentGranted = function() {
                  window.setCookieConsent("granted");
                  window.setGtagConsentStatus("update", "granted");
                  window.hideCookieBanner();
                }
              
                window.handleCookieConsentDenied = function() {
                    window.setCookieConsent("denied");
                    window.setGtagConsentStatus("update", "denied");
                    window.hideCookieBanner();
                }
    
                let hideCookieBanner = window.getCookieConsent() != "unknown";
                if (hideCookieBanner)
                {
                    window.hideCookieBanner();
                }
              
            </script>
        </div>
    </div>
</body>

</html>