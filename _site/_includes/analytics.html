<script>
  window.getCookieConsent = function() {
      try {
          const consent = document.cookie.match(/cookie-consent=([^;]+)/)[1];
          return consent;
      } catch (error) {
          console.log("failed to retrieve consent", error);
          return "unknown";
      }
  };

  window.setCookieConsent = function(status) {
    // get dates for cookie expiration
    let today = new Date();
    let oneYear = new Date(today.getFullYear() + 1, today.getMonth(), today.getDate());
    console.log("cookie-policy-date", oneYear);
    document.cookie = `cookie-consent=${status}; expires=${oneYear}; path=/`;
  }

</script>
<script>
  // Define dataLayer and the gtag function.
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }

  window.setGtagStatus = function(mode, status) {

    if (mode != "update" && mode != "default") {
      throw new Error(`Mode ${mode} is not supported!`);
    }

    if (status != "denied" && status != "granted") {
      throw new Error(`Status ${status} is not supported!`);
    }

    gtag('consent', mode, {
      'ad_storage': status,
      'ad_user_data': status,
      'ad_personalization': status,
      'analytics_storage': status
    });
  }

  // Assume consent is 'denied' as a placeholder
  window.setGtagStatus("default", "denied");

  let currentStatus = window.getCookieConsent();
  let cookiesAllowed = currentStatus == "granted";

  if (cookiesAllowed) {
    // change back to console.log
    alert("cookies already approved");
  } else {
    alert("assume cookies are denied");
  }
</script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-168549883-1">
</script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}

  gtag('js', new Date());
  gtag('config', 'UA-168549883-1');
</script>

<script>

  window.handleCookieConsentGranted = function() {
    console.log("handle consent!");
    window.setCookieConsent("granted");
    window.setGtagStatus("update", "granted");
  }

  window.handleCookieConsentDenied = function() {
    console.log("handle denied!");
  }

</script>