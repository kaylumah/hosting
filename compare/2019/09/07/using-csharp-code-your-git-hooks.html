<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="icon" href="/assets/images/favicon.ico" />
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png" />
        <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png" />
        <link rel="manifest" href="/assets/images/site.webmanifest" />
        <link rel="mask-icon" href="/assets/images/safari-pinned-tab.svg" color="DarkGreen" />
        
        <link href="/compiled.css?v=3049c64" rel="stylesheet" />
        
        
        
        
        <!-- Begin Kaylumah SEO tag v3049c64 -->
        
        <title>Using C# code in your git hooks</title>
        <link rel="canonical" href="https://kaylumah.nl/2019/09/07/using-csharp-code-your-git-hooks.html" />
        
        <meta name="generator" content="Kaylumah v3049c64" />
        <meta name="description" content="Getting started with C# script in your client-side git hooks">
        <!-- <meta name="keywords" content="csharp,git"> -->
        <meta name="author" content="Max Hamuly√°k">
        <meta name="copyright" content="¬© Kaylumah. All rights reserved.">
        
        <meta property="og:locale" content="en" />
        <meta property="og:site_name" content="Max Hamuly√°k ¬∑ Kaylumah" />
        <meta property="og:type" content="article" />
        <meta property="og:title" content="Using C# code in your git hooks">
        <meta property="og:url" content="https://kaylumah.nl/2019/09/07/using-csharp-code-your-git-hooks.html">
        <meta property="og:image" content="https://kaylumah.nl/assets/images/posts/20190907/githooks/cover_image.png">
        <meta property="og:description" content="Getting started with C# script in your client-side git hooks"><meta property="article:author" content="Max Hamuly√°k">
        <meta property="article:published_time" content="2019-09-07T00:00:00.0000000+02:00">
        <meta property="article:modified_time" content="2021-03-21T00:00:00.0000000+01:00">
        
        <meta property="article:tag" content="csharp" />
        
        <meta property="article:tag" content="git" />
        
        
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="Using C# code in your git hooks">
        <meta name="twitter:site" content="@kaylumah">
        <meta name="twitter:creator" content="@kaylumah" />
        <meta name="twitter:description" content="Getting started with C# script in your client-side git hooks">
        <meta name="twitter:image" content="https://kaylumah.nl/assets/images/posts/20190907/githooks/cover_image.png">
        
        <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "BlogPosting",
          "image": "https://kaylumah.nl/assets/images/posts/20190907/githooks/cover_image.png",
          "mainEntityOfPage": "https://kaylumah.nl/2019/09/07/using-csharp-code-your-git-hooks.html",
          "author": {
            "@context": "https://schema.org",
            "@type": "Person",
            "name": "Max Hamuly√°k",
            "url": "https://kaylumah.nl"
          },
          "dateModified": "2021-03-21",
          "datePublished": "2019-09-07",
          "headline": "Using C# code in your git hooks"
        }
        </script>
        
        <!-- End Kaylumah SEO tag -->
        <!-- BEGIN Feed MetaData-->
        <link
          type="application/atom+xml"
          rel="alternate"
          href="https://kaylumah.nl/feed.xml"
          title="Max Hamuly√°k ¬∑ Kaylumah RSS Feed"
        />
        <!-- END Feed MetaData -->

        <!--
                                                           
          _  __           _                       _        
         | |/ /__ _ _   _| |_   _ _ __ ___   __ _| |__     
         | ' // _` | | | | | | | | '_ ` _ \ / _` | '_ \    
         | . \ (_| | |_| | | |_| | | | | | | (_| | | | |   
         |_|\_\__,_|\__, |_|\__,_|_| |_| |_|\__,_|_| |_|   
                    |___/                                  
                                                           
         ¬© Kaylumah. All rights reserved.                             
         3049c6456867b0bb40f3988e5b73db5159e657de                              
         2.1.3                               
         06/05/2022 14:57:54 +02:00
         site: 5779c7fd-cd79-5890-b41c-18d7868b3777
         page: e8e6ac98-c1e2-5969-a24d-3bbf4d12baea                                  
                                                           
         You found üß∏                                      
                                                           
                                                           
        -->
        
        <script>
        
          const consoleSignatureText = '%cüë®‚Äçüíª Thank you for your visit to my little spot on the internet, be welcome! üß∏';
          const consoleSignatureStyle = `
          font-size: 16px;
          background: #4cae50;
          color: white;
          text-align: center;
          padding: 10px 15px;
          width: 100%;
          border-radius: 20px;
        `;
          console.log(consoleSignatureText, consoleSignatureStyle);
        </script>
        
        <!-- Place your kit's code here -->
        <script data-search-pseudo-elements defer src="https://kit.fontawesome.com/61d3312dd9.js" crossorigin="anonymous"></script>
        
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-168549883-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'UA-168549883-1');
        </script>

        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Roboto&display=swap" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Roboto&display=swap" media="print" onload="this.media='all'" />
        <noscript>
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Roboto&display=swap" />
        </noscript>
    </head>
    <body class="line-numbers bg-gray-100 fa-colors">
        <div class="flex flex-col h-screen">
            <header class="bg-gray-900">
                <nav class="flex flex-wrap items-center justify-between py-4 px-4">
                    <div>
                        <a href="/" rel="author">
                            <!-- <img class="block md:hidden h-12 w-auto" src="/assets/logo_small.svg" alt="Kaylumah" /> -->
                            <img class="h-12 w-20" height="48" width="80" src="/assets/logo.svg" alt="Kaylumah" />
                        </a>
                    </div>
                    <div class="flex md:hidden">
                        <button id="hamburger" class="inline-flex items-center justify-center p-2 rounded-md text-gray-100 hover:text-gray-400 hover:bg-gray-500">
                            <span class="sr-only">Open main menu</span>
                            <svg class="toggle block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                            <svg class="toggle hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="toggle hidden md:flex w-full md:w-auto text-right text-bold mt-5 md:mt-0 border-t-2 border-gray-600 md:border-none"><a href="/about.html" class="block md:inline-block text-gray-100 hover:text-gray-400 px-3 py-3 border-b-2 border-gray-600 md:border-none">
                            About
                        </a><a href="/blog.html" class="block md:inline-block text-gray-100 hover:text-gray-400 px-3 py-3 border-b-2 border-gray-600 md:border-none">
                            Blog
                        </a></div>
                </nav>
                 <script>
                    document.getElementById('hamburger').onclick = function toggleMenu() {
                    const navToggle = document.getElementsByClassName('toggle');
                        for (let i = 0; i < navToggle.length; i++) {
                            navToggle.item(i).classList.toggle('hidden');
                        }
                    };
                </script>
            </header>

            <main class="flex-1 py-4 text-gray-900">
                <article class="py-16 px-6 sm:px-8">
    <header>
        <h1 class="flex flex-col items-center mx-auto">
            <span class="text-gray-900 font-semibold tracking-wide uppercase">Article</span>
            <span class="mt-2 text-3xl font-extrabold tracking-tight text-gray-900 sm:text-4xl">Using C# code in your git hooks</span>
        </h1>
        <picture>
                        
                        <source type="image/webp" srcset="/assets/images/posts/20190907/githooks/cover_image.webp">
                        <img class="mx-auto mt-1" src="/assets/images/posts/20190907/githooks/cover_image.png" alt="cover for Using C# code in your git hooks" height="640" width="1280" />
                        
        </picture>
        <div class="mx-auto mt-1">
            <dl class="rounded-lg sm:grid sm:grid-cols-4">
                <div class="flex flex-col p-6 text-center">
                    <dt class="order-2 mt-2 text-lg leading-6 font-medium text-gray-800">
                        Authored by
                    </dt>
                    <dd class="order-1 text-xl font-extrabold">
                        Max Hamuly√°k
                    </dd>
                </div>
                <div class="flex flex-col p-6 text-center">
                    <dt class="order-2 mt-2 text-lg leading-6 font-medium text-gray-800">
                        Posted on
                    </dt>
                    <dd class="order-1 text-xl font-extrabold">
                        <time datetime="2019-09-07">2019/09/07</time>
                    </dd>
                </div>
                <div class="flex flex-col p-6 text-center">
                    <dt class="order-2 mt-2 text-lg leading-6 font-medium text-gray-800">
                        Reading time
                    </dt>
                    <dd class="order-1 text-xl font-extrabold">
                        6 minute
                    </dd>
                </div>
                <div class="flex flex-col p-6 text-center">
                    <dt class="order-2 mt-2 text-lg leading-6 font-medium text-gray-800">
                        Published in
                    </dt>
                    <dd class="order-1 text-xl font-extrabold">
                    
                                        <a href="/archive.html#csharp" title="for the C# programming language" class="text-gray-800">
                                            <!-- <span class="text-gray-600">#</span> -->
                                            C#
                                        </a>
                                        
                                        <a href="/archive.html#git" title="for the Git version control system" class="text-gray-800">
                                            <!-- <span class="text-gray-600">#</span> -->
                                            Git
                                        </a>
                                        
                    </dd>
                </div>
            </dl>
        </div>
        
        <hr class="mt-8 border-t-2 w-20 mx-auto" />
    </header>
    <div class="mt-8 mx-auto max-w-prose md:max-w-7xl prose md:prose-lg lg:prose-xl">
        <h2 id="why-use-hooks"><a href="#why-use-hooks">Why use hooks?</a></h2>
<p>We, as developers, love platforms like GitHub, GitLab, Atlassian, Azure DevOps etc., as our managed git system and collaboration platform. We also love clean code and keep inventing new linters and rules to enforce it. In my opinion, every commit should allow the codebase to deploy to production. There is nothing worse than commits like ‚Äúfixed style errors‚Äù or ‚Äúfixed build‚Äù. These are often small mistakes you want to know as early as possible in your development cycle. You don‚Äôt want to break the build for the next developer because he pulled your ‚Äòmistake‚Äô or waste precious build minutes of your CI server. Say you have asked your teammate to review your code; in the meantime, the build server rejects your code. That means you have to go back and fix this, and your teammate has to come back and possibly review again after the changes (i.e., approvals reset on new commit). Doing so would waste a lot of time and effort.</p>
<blockquote>
<p><strong>note</strong>: I favour server-side hooks, but when using a SaaS solution, this is not always a possibility. I know I would not want someone to run arbitrary code on my servers. Unfortunately, a developer can bypass the client-side hooks. Until we can run, possibly sandboxed, server-side hooks on our prefered platform, we have to make the best of it by using client-side hooks.</p>
</blockquote>
<p>Githooks are scripts that can execute on certain parts of the git lifecycle. Hooks must be executable, but other than that, hooks' power is only limited to the developer's imagination. I have seen many samples of hooks written in JavaScript (node) using tools like <a href="https://github.com/typicode/husky" class="external">husky</a> and <a href="https://github.com/conventional-changelog/commitlint" class="external">commitlint</a> to enforce a certain way of working. When I was browsing the changes in the upcoming .NET Core 3.0 release, the concept of <a href="https://docs.microsoft.com/en-us/dotnet/core/whats-new/dotnet-core-3-0#local-dotnet-tools" class="external">local-tools</a> got me thinking. I knew of the existence of <a href="https://www.hanselman.com/blog/CAndNETCoreScriptingWithTheDotnetscriptGlobalTool.aspx" class="external">dotnet-script</a>, would that make it possible to C# in my GitHooks?</p>
<blockquote>
<p><strong>note</strong>: in the past I have used a set-up with node since I occasionally work with front-end frameworks like Angular. Since I had node installed I could use it even in my pure backend projects to enforce commit messages and such. For me it felt dirty, since that would require team members to have node installed. Using the dotnet cli feels less as a forced decision since members are likely to have it installed already.</p>
</blockquote>
<h2 id="lets-get-started"><a href="#lets-get-started">Let‚Äôs get started!</a></h2>
<p>When creating a git repository there is a folder called hooks where all the git hooks are placed. For every event there is a sample post-fixed with .sample that shows the possibility of each hook. This directory is not under source control and we are going to create our own directory to be able to share the hooks with the team.</p>
<pre><code class="language-bash">mkdir git-hooks-example  
cd git-hooks-example  
git init  
dotnet new gitignore  
dotnet new tool-manifest  
dotnet tool install dotnet-script  
dotnet tool install dotnet-format  
mkdir .githooks
</code></pre>
<h3 id="pre-commit-hook"><a href="#pre-commit-hook">Pre-Commit Hook</a></h3>
<p>To demonstrate we are going to create a plain hook. To check if it is working <strong>git commit -m ‚Äú‚Äù</strong> (using empty commit message will abort the commit). You should see the line pre-commit hook printed.</p>
<pre><code class="language-csharp">#!/usr/bin/env dotnet dotnet-script
Console.WriteLine(&quot;pre-commit hook&quot;);
</code></pre>
<p>To make it executable run:</p>
<pre><code class="language-bash">find .git/hooks -type f -exec rm {} \;
find .githooks -type f -exec chmod +x {} \;
find .githooks -type f -exec ln -sf ../../{} .git/hooks/ \;
</code></pre>
<p>Since we can reference other files (and even load nuget packages) in our csx we will first create a couple of files so we can have code-reuse between the hooks.</p>
<p>Create a file called <strong>logger.csx</strong></p>
<pre><code class="language-csharp">public class Logger
{
    public static void LogInfo(string message)
    {
        Console.ForegroundColor = ConsoleColor.White;
        Console.Error.WriteLine(message);
    }
    public static void LogError(string message)
    {
        Console.ForegroundColor = ConsoleColor.Red;
        Console.Error.WriteLine(message);
    }
}
</code></pre>
<p>Create a file called <strong>command-line.csx</strong></p>
<pre><code class="language-csharp">#load &quot;logger.csx&quot;
public class CommandLine
{
    public static string Execute(string command)
    {
        // according to: https://stackoverflow.com/a/15262019/637142
        // thans to this we will pass everything as one command
        command = command.Replace(&quot;\&quot;&quot;, &quot;\&quot;\&quot;&quot;);
        var proc = new Process
        {
            StartInfo = new ProcessStartInfo
            {
                FileName = &quot;/bin/bash&quot;,
                Arguments = &quot;-c \&quot;&quot; + command + &quot;\&quot;&quot;,
                UseShellExecute = false,
                RedirectStandardOutput = true,
                CreateNoWindow = true
            }
        };
        proc.Start();
        proc.WaitForExit();
        if (proc.ExitCode != 0)
        {
            Logger.LogError(proc.StandardOutput.ReadToEnd());
            return proc.ExitCode.ToString();
        }
        return proc.StandardOutput.ReadToEnd();
    }
}
</code></pre>
<p>Create a file called <strong>dotnet-commands.csx</strong></p>
<pre><code class="language-csharp">#load &quot;logger.csx&quot;
#load &quot;command-line.csx&quot;
public class DotnetCommands
{
    public static int FormatCode() =&gt; ExecuteCommand(&quot;dotnet format&quot;);
    public static int BuildCode() =&gt; ExecuteCommand(&quot;dotnet build&quot;);

    public static int TestCode() =&gt; ExecuteCommand(&quot;dotnet test&quot;);

    private static int ExecuteCommand(string command)
    {
        string response = CommandLine.Execute(command);
        Int32.TryParse(response, out int exitCode);
        return exitCode;
    }

}
</code></pre>
<p>Create a file called <strong>git-commands.csx</strong></p>
<pre><code class="language-csharp">#load &quot;logger.csx&quot;
#load &quot;command-line.csx&quot;
public class GitCommands
{
    public static void StashChanges()
    {
        CommandLine.Execute(&quot;git stash -q --keep-index&quot;);
    }
    public static void UnstashChanges()
    {
        CommandLine.Execute(&quot;git stash pop -q&quot;);
    }
}
</code></pre>
<p>We now have a utility in place for Logging and running GIT and dotnet commands. Next we are going to start with out pre-commit hook. Create a file called <strong>pre-commit</strong> The difference between this file and the others we just made is that we don‚Äôt specify the extension, and that using Shebang we explicitly load dotnet-script. For an explanation of each hook see the article posted below.</p>
<p><a href="https://www.atlassian.com/git/tutorials/git-hooks" class="external">Git Hooks | Atlassian Git Tutorial</a></p>
<pre><code class="language-csharp">#!/usr/bin/env dotnet dotnet-script
#load &quot;logger.csx&quot;
#load &quot;git-commands.csx&quot;
#load &quot;dotnet-commands.csx&quot;

// We'll only runchecks on changes that are a part of this commit so let's stash others
GitCommands.StashChanges();

int buildCode = DotnetCommands.BuildCode();

// We're done with checks, we can unstash changes
GitCommands.UnstashChanges();
if (buildCode != 0) {
    Logger.LogError(&quot;Failed to pass the checks&quot;);
    Environment.Exit(-1);
}
// All checks have passed
</code></pre>
<p>If we run <strong>git commit -m ‚Äú‚Äù</strong> again this time we get an error saying Failed to pass the checks, which makes sense since we don‚Äôt have a project yet. We are going to create a simple sln consisting of a classlibary and a test libary.</p>
<pre><code class="language-bash">dotnet new sln  
dotnet new classlib --framework netstandard2.1 --langVersion 8 --name SomeLib --output src/SomeLib  
dotnet new xunit --output tests/SomeLibTests  
dotnet sln add **/*.csproj 
cd tests/SomeLibTests/  
dotnet add reference ../../src/SomeLib/SomeLib.csproj  
cd ../../  
dotnet build
</code></pre>
<p>If we use git commit -m ‚Äú‚Äù one more time, we get the message about aborting the commit again. We now know that every commit will at least compile :-) If for example we remove the namespace ending curly brace from Class1 we get the error <strong>Class1.cs(7,6): error CS1513: }</strong>. If we extend our pre-commit hook even further we can have <a href="https://www.hanselman.com/blog/EditorConfigCodeFormattingFromTheCommandLineWithNETCoresDotnetFormatGlobalTool.aspx" class="external">dotnet-format</a> and dotnet-test running on every commit. If we purposely write a failing test (1 equals 0 or something like that) the build won‚Äôt pass.</p>
<pre><code class="language-csharp">#!/usr/bin/env dotnet dotnet-script
#load &quot;logger.csx&quot;
#load &quot;git-commands.csx&quot;
#load &quot;dotnet-commands.csx&quot;

Logger.LogInfo(&quot;pre-commit hook&quot;);

// We'll only runchecks on changes that are a part of this commit so let's stash others
GitCommands.StashChanges();

int formatCode = DotnetCommands.FormatCode();
int buildCode = DotnetCommands.BuildCode();
int testCode = DotnetCommands.TestCode();

// We're done with checks, we can unstash changes
GitCommands.UnstashChanges();
int exitCode = formatCode + buildCode + testCode;
if (exitCode != 0) {
    Logger.LogError(&quot;Failed to pass the checks&quot;);
    Environment.Exit(-1);
}
// All checks have passed
</code></pre>
<h3 id="prepare-commit-message-hook"><a href="#prepare-commit-message-hook">Prepare-commit-message hook</a></h3>
<p>Thus far, we have not really used anything we need C# for; Admittedly we are using C# to execute shell commands. For our next hook we are going to use System.IO. Imagine as a team you have a commit-message convention. Let's say you want each commit message to include a reference to your issue tracker.</p>
<pre><code class="language-text">type(scope?): subject  #scope is optional
</code></pre>
<p>Create a file <strong>prepare-commit-msg</strong> in this hook we can provide a convenient commit message place holder if the user did not supply a message. To actual enforce the message, you need the <strong>commit-msg</strong> hook. In this example, we only create a message for feature branches.</p>
<pre><code class="language-csharp">#!/usr/bin/env dotnet dotnet-script
#load &quot;logger.csx&quot;
#load &quot;util.csx&quot;
#load &quot;git-commands.csx&quot;

Logger.LogInfo(&quot;prepare-commit-msg hook&quot;);

string commitMessageFilePath = Util.CommandLineArgument(Args, 0);
string commitType = Util.CommandLineArgument(Args, 1);
string commitHash = Util.CommandLineArgument(Args, 2);

if (commitType.Equals(&quot;message&quot;)) {
    // user supplied a commit message, no need to prefill.
    Logger.LogInfo(&quot;commitType message&quot;);
    Environment.Exit(0);
}

string[] files = GitCommands.ChangedFiles();
for(int i = 0; i &lt; files.Length; i++) {
    // perhaps determine scope based on what was changed.
    Logger.LogInfo(files[i]);
}

string branch = GitCommands.CurrentBranch();
if (branch.StartsWith(&quot;feature&quot;)) {
    string messageToBe = &quot;feat: ISS-XXX&quot;;
    PrepareCommitMessage(commitMessageFilePath, messageToBe);
}

public static void PrepareCommitMessage(string messageFile, string message)
{
     string tempfile = Path.GetTempFileName();
    using (var writer = new StreamWriter(tempfile))
    using (var reader = new StreamReader(messageFile))
    {
        writer.WriteLine(message);
        while (!reader.EndOfStream)
            writer.WriteLine(reader.ReadLine());
    }
    File.Copy(tempfile, messageFile, true);
}
</code></pre>
<p>Create a new helper called <strong>util.csx</strong></p>
<pre><code class="language-csharp">public class Util
{
    public static string CommandLineArgument(IList&lt;string&gt; Args, int position)
    {
        if (Args.Count() &gt;= position + 1)
        {
            return Args[position];
        }
        return string.Empty;
    }

}
</code></pre>
<h3 id="commit-msg-hook"><a href="#commit-msg-hook">Commit-msg Hook</a></h3>
<p>The final local git hook I took for a spin is the commit-msg hook. It uses a regex to make sure the commit message is according the specified format.</p>
<pre><code class="language-csharp">#!/usr/bin/env dotnet dotnet-script
#load &quot;logger.csx&quot;
#load &quot;util.csx&quot;
#load &quot;git-commands.csx&quot;
using System.Text.RegularExpressions;

Logger.LogInfo(&quot;commit-msg hook&quot;);

string commitMessageFilePath = Util.CommandLineArgument(Args, 0);
string branch = GitCommands.CurrentBranch();
Logger.LogInfo(commitMessageFilePath);
Logger.LogInfo(branch);
string message = GetCommitedMessage(commitMessageFilePath);
Logger.LogInfo(message);

const string regex = @&quot;\b(feat|bug)\b(\({1}\b(core)\b\){1})?(:){1}(\s){1}(ISS-[0-9]{0,3}){1}&quot;;
var match = Regex.Match(message, regex);

if (!match.Success) {
    Logger.LogError(&quot;Message does not match commit format&quot;);
    Environment.Exit(1);
}

public static string GetCommitedMessage(string filePath) {
    return File.ReadAllLines(filePath)[0];
}
</code></pre>
<h3 id="pre-push-hook"><a href="#pre-push-hook">pre push Hook</a></h3>
<p>It is even possible to use NuGet packages in our hooks. Let say we want to prevent pushes to master (perhaps not even commits?). We can read a config file using Newtonsoft.Json and look for a protected branch and abort.</p>
<pre><code class="language-csharp">#!/usr/bin/env dotnet dotnet-script
#r &quot;nuget: Newtonsoft.Json, 12.0.2&quot;
#load &quot;logger.csx&quot;
#load &quot;config.csx&quot;
#load &quot;git-commands.csx&quot;
using Newtonsoft.Json;

string currentBranch = GitCommands.CurrentBranch().Trim();
Config currentConfig = GetConfig();
bool lockedBranch = currentConfig.ProtectedBranches.Contains(currentBranch);

if (lockedBranch) {
    Logger.LogError($&quot;Trying to commit on protected branch '{currentBranch}'&quot;);
    Environment.Exit(1);
}

public static Config GetConfig()
{
    return JsonConvert.DeserializeObject&lt;Config&gt;(File.ReadAllText(&quot;.githooks/config.json&quot;));
}
</code></pre>
<h2 id="conclusion"><a href="#conclusion">Conclusion</a></h2>
<p>My current hooks are far from the best, and perhaps C# is not the fastest language to use in git hook. I do, however consider the experiment a success. I much rather code in C# than in shell script. Ideas for further improvement include</p>
<ul>
<li>based on the list of changes, determine the scope of the change (i.e. only one directory changed we might know the scope)</li>
<li>configure the regex, allowed scopes, allowed types</li>
<li>improve pre-commit-msg for more scenarios</li>
<li>enforce users to use the hooks</li>
<li>managing versions of the hooks, on checkout old / different version of pull (with an update of the hooks) sync the directory. <a href="https://www.viget.com/articles/two-ways-to-share-git-hooks-with-your-team/" class="external">(perhaps githook location)</a></li>
</ul>
<p>Let me know what you think :-)</p>
<p><a href="https://github.com/maxhamulyak/git-hooks-example" class="external">maxhamulyak/git-hooks-example</a></p>
<p>Happy Coding üçª</p>
    </div>

    <footer class="flex flex-col mt-8">
        
                <div class="social-share">
            <span class="mx-auto">Enjoying my content? Consider sharing and help me grow my audience :)</span>
            <div class="flex justify-center space-x-6">
                    <a target="_blank" rel=‚Äùnoopener‚Äù title="Share link to post via LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https://kaylumah.nl/2019/09/07/using-csharp-code-your-git-hooks.html" onclick="window.open(this.href, 'width=550,height=435');return false;">
                        <span class="sr-only">LinkedIn Share</span>
                        <em class="fab fa-linkedin fa-lg"></em>
                    </a>
                    <a target="_blank" rel=‚Äùnoopener‚Äù title="Share link to post via Twitter" href="https://twitter.com/intent/tweet?text=Using%20C%23%20code%20in%20your%20git%20hooks&url=https://kaylumah.nl/2019/09/07/using-csharp-code-your-git-hooks.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                        <span class="sr-only">Twitter Share</span>
                        <em class="fab fa-twitter-square fa-lg"></em>
                    </a>
                    <a target="_blank" rel=‚Äùnoopener‚Äù title="Share link to post via Facebook" href="https://facebook.com/sharer.php?u=https://kaylumah.nl/2019/09/07/using-csharp-code-your-git-hooks.html" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                        <span class="sr-only">Facebook Share</span>
                        <em class="fab fa-facebook fa-lg"></em>
                    </a>
                    <a target="_blank" rel=‚Äùnoopener‚Äù title="Share link to post via Email" href="mailto:?subject=Using C# code in your git hooks&amp;body=Thought you might like this article https://kaylumah.nl/2019/09/07/using-csharp-code-your-git-hooks.html">
                        <span class="sr-only">Email Share</span>
                        <em class="fas fa-envelope-open-text fa-lg"></em>
                    </a>
            </div>
        </div>
                
        
                <script src="  https://unpkg.com/showdown/dist/showdown.min.js"></script>
        <script>
        const GH_ISSUE_API = 'https://api.github.com/repos/kaylumah/kaylumah.github.io/issues/12/comments?per_page=100';
        let request = new XMLHttpRequest();
        request.open( 'GET', GH_ISSUE_API, true );
        
        request.onload = function() {
            if ( this.status >= 200 && this.status < 400 ) { 
                let response = JSON.parse( this.response );
        
                for ( var i = 0; i < response.length; i++ ) {
        			document.getElementById( 'gh-comments-list' ).appendChild( createCommentEl( response[ i ] ) );
        		}
                document.getElementById( 'no-comments-found' ).style.display = 0 === response.length  ? 'block' : 'none';
            }
            else {
                console.error( this );
            }
        };
        
        function createCommentEl( response ) {
            let userName = document.createElement('h3');
            userName.classList.add('text-sm', 'font-medium');
            userName.innerHTML = `@${response.user.login}`;
        
            let commentTime = document.createElement('p');
            commentTime.classList.add('text-sm', 'text-gray-700');
            commentTime.textContent = response.created_at;
        
            let commentMetadata = document.createElement('div');
            commentMetadata.classList.add('flex', 'items-center', 'justify-between');
            commentMetadata.appendChild(userName);
            commentMetadata.appendChild(commentTime);
        
            let commentContents = document.createElement('p');
            commentContents.classList.add('mx-auto', 'prose', 'md:prose-lg', 'lg:prose-xl');
            commentContents.innerHTML = response.body;
            // Progressive enhancement.
        	if ( window.showdown ) {
        		let converter = new showdown.Converter();
        		commentContents.innerHTML = converter.makeHtml( response.body );
        	}
        
            let commentWrapper = document.createElement('div');
            commentWrapper.classList.add('flex-1', 'space-y-1');
            commentWrapper.appendChild(commentMetadata);
            commentWrapper.appendChild(commentContents);
        
            let userAvatar = document.createElement( 'img' );
            userAvatar.classList.add('h-8', 'w-8');
        	userAvatar.setAttribute( 'src', response.user.avatar_url );
            userAvatar.setAttribute( 'alt', `${response.user.login} GitHub Avatar` );
            userAvatar.setAttribute( 'width', 32 );
            userAvatar.setAttribute( 'height', 32 );
        
            let commentLink = document.createElement('a');
            commentLink.classList.add('flex', 'space-x-3');
            commentLink.appendChild(userAvatar);
            commentLink.appendChild(commentWrapper);
            commentLink.setAttribute( 'href', response.html_url );
        
            let comment = document.createElement('li');
            comment.classList.add('py-4');
            comment.setAttribute( 'data-created', response.created_at );
        	comment.setAttribute( 'data-author-avatar', response.user.avatar_url );
        	comment.setAttribute( 'data-user-url', response.user.url );
            comment.appendChild(commentLink);
        
            return comment;
        }
        
        request.send();
        </script>
        
        <div class="github-comments" class="mt-2">
        	<h2>Comments</h2>
        	<ul class="divide-y divide-gray-200" id="gh-comments-list">
                <noscript>Please enable JavaScript to load the comments.</noscript>
                <li id="no-comments-found" class="py-4">
                    <span class="text-sm font-semibold">No comments found for this article.</span>
                </li>
            </ul>
        	<p id="leave-a-comment">Join the discussion for this article on <a class="font-semibold external" href="https://github.com/kaylumah/kaylumah.github.io/issues/12">this ticket</a>.</p>
        </div>
                
    </footer>
   
</article>
                <button class="fixed z-50 bottom-4 right-4 w-16 h-16 rounded-full bg-gray-300 text-white block" onclick="topFunction()" id="myBtn" title="Go to top">
                    <span class="sr-only">Back to top!</span>
                    <em class="fad fa-angle-double-up fa-lg"></em>
                </button>
                <script>
                    var mybutton = document.getElementById("myBtn");
                
                    window.onscroll = function() {scrollFunction()};
                
                    function scrollFunction() {
                        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                            mybutton.style.display = "block";
                        }
                        else {
                            mybutton.style.display = "none";
                        }
                    }
                    function topFunction() {
                        document.body.scrollTop = 0;
                        document.documentElement.scrollTop = 0;
                    }
                </script>
            </main>
            <footer class="bg-gray-900">
                <div class="py-4 px-4">
                    <div class="flex justify-center space-x-6">
                        
                        <a target="_blank" rel=‚Äùnoopener‚Äù href="https://www.linkedin.com/in/maxhamulyak" class="text-gray-100 hover:text-gray-400">
                            <span class="sr-only">LinkedIn</span>
                            <em class="fab fa-linkedin fa-lg"></em>
                        </a>
                        <a target="_blank" rel=‚Äùnoopener‚Äù href="https://github.com/kaylumah" class="text-gray-100 hover:text-gray-400">
                            <span class="sr-only">GitHub</span>
                            <em class="fab fa-github-square fa-lg"></em>
                        </a>
                        <a target="_blank" rel=‚Äùnoopener‚Äù href="https://twitter.com/kaylumah" class="text-gray-100 hover:text-gray-400">
                            <span class="sr-only">Twitter</span>
                            <em class="fab fa-twitter-square fa-lg"></em>
                        </a>
                    </div>
                    <div class="pt-2 flex flex-col text-center text-gray-100">
                        <span>¬© Kaylumah. All rights reserved.</span>
                        <span class="text-xs">Deployed from commit <a class="hover:text-gray-400" href="https://github.com/kaylumah/kaylumah.github.io/commit/3049c6456867b0bb40f3988e5b73db5159e657de">3049c64</a> via build <a class="hover:text-gray-400" href="https://github.com/kaylumah/kaylumah.github.io/actions/runs/1">20220605.025709</a></span>
                    </div>
                    <div class="pt-2 flex justify-center space-x-6">
                        <a href="/" class="text-gray-100 hover:text-gray-400">
                            <span class="sr-only">Kaylumah</span>
                            <em class="fak fa-logo-kaylumah fa-lg"></em>
                        </a>
                    </div>
                </div>
            </footer>
        </div>
        
    </body>
</html>